## 第一章 Linux系统安装

###  1.1 系统分区

#### 1.1.1 分区类型

- 主分区： 最多只能有4个
- 扩展分区：
  - 最多只能有**1个**
  - 主分区加扩展分区最多有**4个**
  - 不能写入数据，只能用于包含逻辑分区
- 逻辑分区
  - 逻辑分区标记名一定是从**“5”**开始

#### 1.1.2 硬件设备文件名

**"/dev":该文件夹下存放的都是硬件文件**

| 硬件              | 设备                 |
| :---------------- | :------------------- |
| IDE硬盘           | /dev/hd[a-d]         |
| SCSI/SATA/USB硬盘 | /dev/sd[a-p]         |
| 光驱              | /dev/cdrom或/dev/sr0 |
| 软盘              | /dev/fd[0-1]         |
| 打印机（25针）    | /dev/lp[0-2]         |
| 打印机（USB）     | /dev/usb/lp[0-15]    |
| 鼠标              | /dev/mouse           |

#### 1.1.3 挂载

- 必须分区
  - /(根分区)
  - swap分区（交换分区，内存2倍，不操过2GB）
- 推荐分区
  - /boot(启动分区，200MB)

#### 1.1.4 总结

1. 分区：把大硬盘分为小的逻辑分区
2. 格式化：目的是写入文件系统
3. 分区设备文件名：给每个分区定义设备文件名
4. 挂载：给每个分区分配挂载点

#### 1.1.5 网络设置

1. 桥接：

   - **特点：**利用**真实网卡**链接，设置虚拟机与计算机**网段一致**即可与计算机进行通讯，还可与局域网和外部网络进行通信。

   - **缺点：**会占用网段的一个ip，可能**会导致与该局域网中其他计算机网络冲突**。

   - 常见问题：因为真实网卡存在多个，桥接网络时可通过：

     ​					**工具栏 - >编辑 -> 虚拟网络编辑器** 

     ​					中指定桥接的网卡。

2. NAT：

   - **特点：**通过**VMnet8**虚拟网卡与主机通讯，若主机可访问互联网，则虚拟机也可访问互联网（但不能访问局域网），设置虚拟机与计算机**网段一致**即可与计算机进行通讯。

3. 仅主机模式：

   - **特点：**通过**VMnet1**与主机通讯，**只能和主机进行通讯**，设置虚拟机与计算机**网段一致**即可与计算机进行通讯。

## 2 给初学者的建议

- Linux不靠扩展名区分文件类型（加扩展名是为了方便用户识别文件类型）
  - 压缩包：“*.gz”,"*.bz2","*.tar.bz2","*tgz"等
  - 二进制软件包：“rpm”
  - 网页文件：“*.html","*.php"
  - 脚本文件：“*.sh"
  - 配置文件："*.conf"



- Linux所有的存储设备都必须挂载之后用户才能使用，包括硬盘、U盘和光盘



- Windows下的程序不能直接在Linux中安装和运行

### 2.1 Linux各目录的作用

|    目录名    | 目录作用                                                     |
| :----------: | ------------------------------------------------------------ |
|    /bin/     | 存放**系统命令**的目录，**普通用户和超级用户都可以执行**。不过放在/bin下的命令在单用户模式下也可以执行 |
|    /sbin/    | 保存和**系统环境设置**相关的命令，**只有超级用户**可以使用这些命令进行环境设置。但是有些命令可以允许普通用户查看 |
|  /usr/bin/   | 存放**系统命令**的目录，**普通用户和超级用户都可以**执行。这些命令和系统启动无关，在单用户模式下不能执行 |
|  /usr/sbin/  | 存放根文件系统不必要的系统管理命令，例如多数服务程序。只有超级用户可以使用。大家其实可以注意到Linux的系统，在所有**“sbin”**目录中保存的命令**只有超级用户可以使用**，**“bin”**目录中保存的命令**所有用户都可以使用** |
|    /boot/    | **系统启动**目录，保存系统启动相关的文件，如内核文件和启动引导程序（grub）文件等 |
|    /dev/     | **设备文件保存位置**。这个目录就是用来保存所有硬件设备文件的 |
|    /etc/     | **配置文件保存位置**。系统内所有采用默认安装方式（rpm安装）的服务的配置文件全部都保存在这个目录当中，如用户账户和密码，服务的启动脚本，常用服务的配置文件等 |
|    /home/    | **普通用户的家目录**。建立每个用户时，每个用户要有一个默认登录位置，这个位置就是这个用户的家目录，所有普通用户的家目录就是在/home下建立一个和用户名相同的目录。如用户user1的家目录就是/home/user1 |
|    /lib/     | 系统调用的函数库保存位置                                     |
| /lost+found/ | 当系统意外崩溃或机器意外关机，而产生一些文件碎片放在这里。当系统启动的过程中fsck工具会检查这里，并修复已经损坏的文件系统。这个目录只在每个分区中出现，例如/lost+found就是根分区的备份恢复目录，/boot/lost+found就是/boot分区的备份恢复目录 |
|   /media/    | 挂载目录。系统甲乙是用来挂载媒体设备的，例如软盘和光盘       |
|    /mnt/     | 挂载目录。早期Linux中只有这一个挂载目录，并没有细分。现在这个目录系统建议挂载额外设备，如U盘，移动硬盘和其他操作系统的分区 |
|    /misc/    | 挂载目录。系统加以用来挂载NFS服务的共享目录。我们在刚刚已经解释了挂载，童鞋们应该知道只要是一个已经建立的孔木兰就可以作为挂载点。那么**系统虽然准备了三个默认挂载目录/media、/mnt、/misc，但是到底在哪个目录中挂载什么设备都可以由管理员自己决定**。如/mnt/cdrom挂载光盘，/mnt/usb挂载U盘，这都是可以的 |
|    /opt/     | 第三方安装的软件保存位置。这个目录就是放置和安装其他软件的位置，我手工安装的源码包软件都可以安装到这个目录当中。不过现在通常大家习惯把软件放置到**/usr/local/**目录中 |
|    /proc/    | 虚拟文件系统，**该目录中的数据**并不保存到硬盘当中，而是保存到**内存中**。主要保存系统的内核，进程，外部设备状态和网络状态灯。 |
|    /sys/     | 虚拟文件系统。和/proc目录类似，都是**保存在内存**当中的，主要是保存于内核相关信息的 |
|    /root/    | **超级用户的家目录**。普通用户家目录在“/home"下，超级用户家目录直接在‘’/‘下 |
|    /srv/     | **服务数据目录**。一些系统服务启动之后，可以在这个目录中保存所需要的的数据 |
|    /tmp/     | **临时目录**。系统存放临时文件的目录，该目录下所有用户都可以访问和写入。我们建议此目录中不能保存重要数据，最好每次开机都把该目录清空 |
|    /usr/     | **系统软件资源目录**。注意usr不是user的缩写，而是"Unix Software Resource"的缩写，所以不是存放用户数据，而是存放系统软件资源的目录。系统中安装的软件大多数保存在这里 |
|    /var/     | **动态数据保存位置**。主要保存缓存、日志以及软件运行所产生的文件。 |











## 3 Linux常用命令

### 3.1 文件处理命令

#### 3.1.1 命令格式与目录处理命令ls

**命令格式**

命令格式：命令 [-选项] [参数]

​		例如：ls -la /etc

说明：1）个别命令使用不遵循此格式

​			2）当有多个选项时，可以写在一起

​			3）简化选项与完整选项

​					-a等于 --all

---

##### 1）ls：目录处理命令

- 命令名称：ls
- 命令英文原意：list
- 命令所在路径：/bin/ls     (注："/bin"目录下说明所有用户都可操作)
- 执行权限：所有用户
- 功能描述：显示目录文件
- 语法：ls 选项  [文件或目录]
  - -a	（all）显示所有文件，包括隐藏文件
  - -l    （long） 详细信息显示
  - -d    （dir）查看目录属性
  - -i     （iNode)显示每个文件i节点号

---

##### 2）-rw-r--r--：访问权限

- 开头的“-”符号：文件类型 

  （“-“：二进制文件；”d”：目录；“l”：软连接文件）

- rw- r-- r--

  u    g   o

  u:所有者	g：所属组	o：其他人

  r：读	w：写	x：执行

#### 3.1.2 目录处理命令

##### mkdir：目录处理命令

- 命令名称：mkdir

- 命令英文原意：make directories

- 命令所在路径：/bin/mkdir

- 执行权限：所有用户

- 语法：mkdir -p [目录名]

- 功能描述：创建新目录

  ​				-p	递归创建

---

##### pwd：显示当前目录

- 命令英文原意：print working directory
- 命令所在路径：/bin/pwd
- 执行权限：所有用户
- 语法：pwd
- 功能描述：显示当前目录

##### cd:切换目录

- 命令名称：cd

- 英文原意：change directory

- 命令所在路径：shell内置命令

- 执行权限：所有用户

- 语法：cd [目录]

- 范例： cd /tmp/movie/kongfu 切换到指定目录

  ​			cd ..    回到上一级目录

---

##### cp：复制文件或目录

- 名称：cp

- 英文原意：copy

- 所在路径：/bin/cp

- 执行权限：所有用户

- 语法：cp  [源文件或目录] [目标目录]

  ​			-r	复制目录（只复制文件时不需要加)

  ​			-p	保留文件属性

- 功能描述：复制文件或目录

---

##### mv：剪切文件、改名

- 名称：mv
- 英文原意：move
- 所在路径：/bin/mv
- 执行权限：所有用户
- 语法：mv [源文件或目录] [目标目录]

---

#####  rm:删除文件

- 名称：rm

- 英文原意：remove

- 所在路径：/bin/rm

- 执行权限：所有用户

- 语法：rm  [文件或目录] 

  ​					-r	删除目录

  ​					-f	强制执行

- 功能描述：删除文件

#### 3.1.3 文件处理命令

##### touch：创建空文件

- 名称：touch
- 所在路径：/bin/touch
- 执行权限：所有用户
- 语法： touch [文件名]

---

##### cat：显示文件内容

- 名称：cat

- 所在路径：/bin/cat

- 执行权限：所有用户

- 功能描述：显示文件内容

- 语法：cat  [文件名]

  ​				-n	显示行号

---

##### tac：显示文件内容（反向）

- 所在路径：/usr/bin/tac
- 执行权限：所有用户
- 语法：tac [文件名]

---

##### more：分页显示文件内容（只能下翻页）

- 所在路径：/bin/more
- 执行权限：所有用户
- 语法：more [文件名]
- 显示文件内容后操作：
  - （空格）或f	下翻页
  - （Enter）        翻到下一行
  -    q或Q             退出
  - "/"+字符串       查找文件中匹配字符串（n：下一个匹配；N：上一个匹配）

---

##### less：分页显示文件内容（可向上翻页）

- 所在路径：/usr/bin/less
- 执行权限：所有用户
- 语法：less [文件名]
- 显示文件内容后操作：
  - page up：向上翻页
  - 其他与上一条目“more”操作一致

---

##### head：显示文件前面几行（默认10行）

- 所在路径： /usr/bin/head

- 执行权限：所有用户

- 语法：head  [文件名]

  ​						-n	指定行数

---

##### tail：显示文件后面几行（默认10行）

- 所在路径：/usr/bin/tail

- 执行权限：所有用户

- 语法：tail [文件名]

  ​				-n	指定行数

  ​				-f	动态显示文件末尾内容

#### 3.1.4 链接命令

##### ln：生成链接文件

- 英文原意：link

- 所在路径：/bin/ln

- 执行权限：所有用户

- 语法：ln [原文件] [目标文件]

  ​             -s	创建软链接

补充：

​	**软链接特征**：类似Windows快捷方式

  1. lrwxrwxrwx      l:软链接

     软链接文件权限都为rwxrwxrwx

2. 文件大小-只是符号链接

3. 例: /tmp/issue.soft -> /etc/issue

   ​	箭头指向源文件



​	**硬链接特征**：

1. 拷贝cp -p + 同步更新
2. 通过i节点识别（两文件i节点相同）
3. 不能夸分区
4. 不能针对目录使用

### 3.2 权限管理命令

##### chmod：改变文件或目录权限

- 英文原意：change the permissions mode of a file

- 所在路径：/bin/chmod

- 执行权限：文件所有者和管理员root

- 语法：

  1. chmod [{ugoa} {+-=} {rwx}] [文件或目录]

  2. chmod [mode=421] [文件或目录]

     ​	-R	递归修改

  补充：权限的数字表示（按照2进制来看）

  - r --- 4
  - w --- 2
  - x --- 1

  rwxrw-r--

    7     6   4

- 范例：

  - chmod g+w testfile

    赋予文件testfile所属组写权限

  - chmod - R 777 testdir

    修改目录testdir及其目录下文件权限为所有用户具有全部权限



**文件目录权限总结**

| 代表字符 |   权限   |   对文件的含义   |        对目录的含义        |
| :------: | :------: | :--------------: | :------------------------: |
|    r     |  读权限  | 可以查看文件内容 |    可以列出目录中的内容    |
|    w     |  写权限  | 可以修改文件内容 | 可以在目录中创建、删除文件 |
|    x     | 执行权限 |   可以执行文件   |        可以进入目录        |





##### chown:改变目录或文件的所有者

> - 英文原意：change file ownership
> - 所在路径：/bin/chown
> - 执行权限：管理员root
> - 语法：chown [用户] [文件或目录]



##### chgrp：改变文件或目录的所属组

> - 英文原意：change file group ownership
> - 所在路径：/bin/chgrp
> - 语法：chgrp [用户组] [文件或目录]



##### umask：显示、设置文件（文件夹）的缺省权限

> - 英文原意：the user file-creation mask
>
> - 所在路径：Shell内置命令
>
> - 执行权限：
>
> - 范例：
>
>   1. **umask -S**:
>
>      以rwx形式显示新建文件夹的缺省权限（文件缺省权限比文件夹的少x权限）
>
>   2. **umask 077**:
>
>      设置文件夹的缺省权限为 700（与设置的值取反得到），则文件缺省权限为 600（少x权限）

### 3.3 文件搜索命令

##### find：文件搜索

> - 所在路径：/bin/find
>
> - 执行权限：所有用户
>
> - 语法：find [搜索范围] [匹配条件]
>
> - 示例：
>
>   - **find /etc -name init**
>
>     在目录/etc中查找文件init（精确查找；可使用“*****”和“**？**”做模糊查找）
>
>     **-iname** 不区分大小写
>
>   - **find / -size +204800**
>
>     在根目录下查找大于100MB的文件（上述数值204800单位是“数据块”）
>
>     +n	大于；	-n	小于；	n	等于
>
>     补充：
>
>     ​			Linux下最小的存储单位是数据块：
>
>     ​			1数据块=512字节=0.5k			
>
>   - **find /home -user shenchao**
>
>     在/home目录下查找所有者为shenchao的文件
>
>     -group	根据所属组查找
>
>   - **find /etc -name init -exec ls -l {} \ **
>
>     在/etc 下查找init文件并显示其详细信息
>
>     -exec/-ok 命令 {}\：对搜索结果执行相应操作
>
>   - **find /etc -size +163840 -a -size -20400**
>
>     在/etc下查找大于8MB且小于100MB的文件
>
>     -a	两个条件同时满足
>
>     -o	两个条件满足任意一个即可
>
>     -type	根据文件类型查找
>
>     ​				f	文件；d	目录；l	软链接文件
>
>     -inum	根据i节点查找



##### locate：在文件资料库中查找文件

> - 所在路径：/usr/bin/locate
> - 执行权限：所有用户
> - 语法：locate 文件名



##### which：搜索命令所在目录及别名信息

> - 所在路径：/usr/bin/which
> - 执行权限：所有用户
> - 语法：which 命令名称



##### whereis：搜索命令所在目录及帮助文档路径

> - 所在路径：/usr/bin/whereis
> - 执行权限：所有用户
> - 语法：whereis 命令名称



##### grep：在文件中搜寻字符串匹配的行并输出

> - 所在路径：/bin/grep
>- 执行权限：所有用户
> - 语法：grep [指定字符串] [文件]
>  - -i	不区分大小写
>   - -v	排除指定字符串
>  - -n    输出行号
>     - --color=auto    搜索出的关键字用颜色显示
>







### 3.4 帮助命令

##### man:获得帮助信息

> - 英文原意：manual
> - 所在路径：/usr/bin/man
> - 执行权限：所有用户
> - 语法：man [命令或配置文件]
>   - 5		表示配置文件的帮助



##### help：获得Shell内置命令的帮助信息

> - 所在路径：Shell内置命令
> - 执行权限：所有用户
> - 语法：help 命令



### 3.5 用户管理命令

##### useradd：添加新用户

> - 所在路径：/usr/sbin/useadd
> - 执行权限：root
> - 语法：useradd 用户名



##### passwd：设置用户密码

> - 所在路径：/usr/bin/passwd
> - 执行权限：所有用户
> - 语法：passwd 用户名



##### who：查看系统当前状态登录用户信息

> - 所在路径：/usr/bin/who
> - 执行权限：所有用户
> - 语法：who



##### w：查看系统当前状态登录用户详细信息

> - 所在路径：/usr/bin/w
> - 执行权限：所有用户
> - 语法：w



### 3.6 压缩和解压命令

##### gzip：压缩成.gz格式文件（不保留原文件）

> - 英文原意：GNU zip
> - 所在路径：/bin/gzip
> - 执行权限：所有用户
> - 语法：gzip [文件]



##### gunzip：解压缩.gz的压缩文件

> - 英文原意：GNU unzip
> - 所在路径：/bin/gunzip
> - 执行权限：所有用户
> - 语法：gunzip [压缩文件]



##### tar：打包或解压目录

> - 所在路径：/bin/tar
>
> - 执行权限：所有用户
>
> - 语法：
>
>   - 打包：tar 选项[-zcvf] [压缩后文件名] [目录]
>
>   ​			-c	打包
>
>   ​			-v	显示详细信息
>
>   ​			-f	指定文件名
>
>   ​			-z	打包同时压缩
>
>   ​	压缩后文件格式：tar.gz
>
>   - 解压：tar 选项[-zxvf] [tar.gz格式文件]
>
>     ​	-x	解包
>
>     ​	-v	显示详细信息
>
>     ​	-f	指定解压文件
>
>     ​	-z	解压缩



##### zip：压缩文件或目录为.zip格式（保留原文件）

> - 所在路径：/usr/bin/zip
>
> - 执行权限：所有用户
>
> - 语法：zip 选项[-r] [压缩后文件名] [文件或目录]
>
>   ​		-r 压缩目录



##### unzip：解压.zip的压缩文件

> - 所在路径：/usr/bin/unzip
> - 执行权限：所有用户
> - 语法：unzip [压缩文件]



##### bzip2：压缩为.bz2格式文件

> - 所在路径：/usr/bin/bzip2
>
> - 执行权限：所有用户
>
> - 语法：bzip2 选项[-k] [文件]
>
>   ​			-k	产生压缩文件后保留源文件



### 3.7 网络命令

##### write：给指定用户发信息

> - 所在路径：/usr/bin/write
> - 执行权限：所有用户
> - 语法：write <用户名>
> - 功能描述：给用户发信息，以Ctrl+D保存结束



##### wall：发广播信息

> - 英文原意：write all
> - 所在路径：/usr/bin/wall
> - 执行权限：所有用户
> - 语法：wall [message]



##### ping：测试网络连通性

> - 所在路径：/bn/ping
>
> - 执行权限：所有用户
>
> - 语法：ping 选项 IP地址
>
>   ​					-c	指定发送次数



##### ifconfig：查看和设置网卡信息（系统关闭后失效）

> - 英文原意： interface configure
> - 所在路径：/sbin/ifconfig
> - 执行权限：root
> - 语法：ifconfig 网卡名称 IP地址
> - 范例：ifconfig eth0 192.168.2.1



##### mail：查看或发送电子邮件

> - 所在路径：/bin/mail
> - 执行权限：所有用户
> - 功能描述：
>   - 单独使用mail：查看邮件列表
>   - mail [用户名]：给指定用户发送邮件



##### last：列出当前与过去登入系统的用户信息及重启信息

> - 所在路径：/usr/bin/last
> - 执行权限：所有用户
> - 语法：last





##### lastlog：查看系统用户最后一次登录的时间

> - 所在路径：/usr/bin/lastlog
> - 执行权限：所有用户
> - 语法：lastlog
> - 范例：
>   - lastlog：查看所有用户最后一次登录信息
>   - lastlog -u  502：只查看id号为502的用户上次登录的信息



##### traceroute：显示数据包到主机间的路径

> - 所在路径：/bin/traceroute
> - 执行权限：所有用户
> - 语法： trace 域名



##### netstat：显示网络相关信息

> - 所在路径：/bin/netatat
> - 执行权限：所有用户
> - 语法：netstat [选项]
> - 选项：
>   - -t：TCP协议
>   - -u：UDP协议
>   - -l：监听
>   - -r：路由
>   - -n：显示IP地址和端口号
> - 范例：
>   - netstat -tlun	查看本机监听的端口
>   - netstat -an       查看本机所有的网络连接
>   - netstat -rn        查看本机路由表



##### setup：配置网络（永久生效）

> - 所在路径：/usr/bin/setup
> - 执行权限：root
> - 语法：setup



##### 挂载命令

> - 所在路径：/bin/mount
> - 执行权限：所有用户
> - 语法：mount [-t 文件系统] 设备文件名 挂载点
> - 范例：mount /dev/sr0 /mnt/cdrom



### 3.8 关机重启命令

##### shutdown命令

> - 语法：shutdown [选项] 时间
> - 选项：
>   - -c：取消前一个关机命令
>   - -h：关机
>   - -r：重启



##### 其他关机命令

> - halt
> - poweroff
> - init 0



##### 其他重启命令

> - reboot
> - init 6



##### runlevel：查看系统运行级别

---

七个系统运行级别

| 等级 | 说明                         |
| :--: | :--------------------------- |
|  0   | 表示关机                     |
|  1   | 单用户模式                   |
|  2   | 无网络连接的多用户命令行模式 |
|  3   | 有网络连接的多用户命令行模式 |
|  4   | 不可用                       |
|  5   | 带图形界面的多用户模式       |
|  6   | 重新启动                     |





##### logout：用户退出登录



## 4 文本编辑器Vim



<img src="D:\java\学习资料\Linux\img\vim工作模式.png" style="zoom:60%;" />



##### 插入命令

| 命令 | 作用                 |
| :--: | -------------------- |
|  a   | 在光标所在字符后插入 |
|  A   | 在光标所在行尾插入   |
|  i   | 在光标所在字符前插入 |
|  I   | 在光标所在行行首插入 |
|  o   | 在光标下插入新行     |
|  O   | 在光标上插入新行     |



##### 定位命令

| 命令      | 作用            |
| :-------- | --------------- |
| :set nu   | 设置行号        |
| :set nonu | 取消行号        |
| gg        | 到第一行        |
| G         | 到最后一行      |
| nG        | 到第n行         |
| :n        | 到第n行（推荐） |
| $         | 移至行尾        |
| 0         | 移至行首        |



##### 删除命令

##### 复制命令

| 命令 | 作用                   |
| ---- | ---------------------- |
| yy   | 复制当前行             |
| nyy  | 复制当前行以下n行      |
| dd   | 剪切当前行             |
| ndd  | 剪切当前行以下n行      |
| p    | 粘贴在当前光标所在行下 |
| P    | 粘贴在当前光标所在行上 |



##### 替换和取消命令

| 命令 | 作用                                |
| ---- | ----------------------------------- |
| r    | 取代光标所在处字符                  |
| R    | 从光标所在处开始替换字符，按Esc结束 |
| u    | 取消上一步操作                      |



##### 搜索和搜索替换命令

| 命令                   | 作用                                             |
| ---------------------- | ------------------------------------------------ |
| /string                | 搜索指定字符串;搜索时忽略大小写 :set ic          |
| n                      | 搜索指定字符串的下一个出现位置                   |
| :%s/old/new/[g或c]     | 全文替换指定字符串（g：不需确认；c：需意义确认） |
| :n1,n2s/old/new/[g或c] | 在一定范围内替换指定字符串                       |



##### 保存和退出命令

| 命令            | 作用                                         |
| --------------- | -------------------------------------------- |
| :w              | 保存修改                                     |
| :w new_filename | 另存为指定文件                               |
| :wq             | 保存修改并退出                               |
| ZZ              | 快捷键，保存修改并退出                       |
| :q!             | 不保存修改退出                               |
| ：wq!           | 强制保存修改并退出（文件所有者及root可使用） |



- 导入命令执行结果	:r !命令
- 定义快捷键    :map 快捷键 触发命令
- 连续行注释    
  - :n1,n2s/^/#/g		n1到n2行首加“#”符(''^"表示行首)
  - :n1,n2s/^#//g        去掉n1到n2行首的“#”号





补充：

​	常用命令可放置到.vimrc文件下，普通用户在/home/用户名/.vimrc，管理员在/root/.vimrc 



### 5 软件包管理

#### 5.1 软件包管理简介

1、软件包分类

- 源码包：
  - 脚本
- 二进制包（RPM包、系统默认包）

#### 5.2 RPM包管理-rpm命令管理

##### 5.2.1 包命名与依赖性

1、RPM包命名规则

> - httpd-2.2.15-15.el6.centos.1.i686.rpm
>   - httpd		软件包名
>   - 2.2.15       软件版本
>   - 15              软件版本发布的次数
>   - el6.centos    适合的Linux平台
>   - i686           适合的硬件平台
>   - rpm           rpm包扩展名



2、RPM包依赖性

> - 树形依赖：a -> b -> c
>
> - 环形依赖：a -> b -> c -> a
>
> - 模块依赖： 
>
>   ​	模块依赖查询网站：www.rpmfind.net



##### 5.2.2 rpm命令管理-安装升级与卸载

1、包全名与包名

> - 包全名：操作的包是没有安装的软件包时，使用包全名。而且要注意路径
> - 包名：操作已经安装的软件包时，使用包名是搜索/var/lib/rpm中的数据库。



2、RPM安装

> - rpm -ivh	包全名
> - 选项：
>   - -i（install）	   安装
>   - -v（verbose）   显示详细信息
>   - -h（hash）         显示进度
>   - --nodeps             不检测依赖性（容易出问题，慎用）



3、RPM包升级

> - rpm -Uvh 包全名
> - 选项：
>   - -U(upgrade)		升级



4、卸载

> - rpm -e 包名
> - 选项：
>   - -e(erase)		卸载
>   - --nodeps        不检查依赖性

##### 5.2.3 rpm命令管理-查询

1、查询是否安装

> - rpm -q 包名
> - 选项：
>   - -q		查询(query)



2、查询所有已安装的软件

> - rpm -qa
> - 选项：
>   - -a		所有(all)



3、查询软件包详细信息

> - rpm -qip  包名
> - 选项：
>   - -i	查询软件信息（information）
>   - -p   查询未安装包信息（package）



4、查询包中文件安装位置

> - rpm - ql 包名
> - 选项：
>   - -l	列表（list)
>   - -p   查询未安装包信息（package）



5、查询系统文件属于哪个RPM包

> - rpm -qf 系统文件名
> - 选项：
>   - -f	查询系统文件属于哪个文件包（file）



6、查询软件包的依赖性

> - rpm -qR 包名
> - 选项：
>   - -R（requires）		查询软件包的依赖性
>   - -p（package）        查询未安装包的信息

##### 5.2.4 rpm命令管理-校验和文件提取

1、RPM包校验

> - rpm -V 已安装的包名
> - 选项：
>   - -V(verify)		校验指定RPM包中的文件



验证内容中的8个信息的具体内容如下：

> - S	文件大小是否改变
> - M   文件的类型或文件的权限（rwx）是否被改变
> - 5     文件MD5校验和是否改变（可以看成文件内容是否改变）
> - D     设备的主从代码是否改变
> - L      文件路径是否改变
> - U     文件的属主（所有者）是否改变
> - G     文件的属组是否改变
> - T     文件的修改时间是否改变





#### 5.3 RPM包管理-yum在线管理

##### 5.3.1 IP地址配置和网络yum源

1、IP地址配置

> - 使用setup工具
>
> - vi /etc/sysconfig/network-scripts/ifcfg-eth0
>
>   ​	把ONBOOT=no改为ONBOOT=yes
>
> - service network restart  重启网卡



2、网络yum源

> - vi /etc/yum.repos.d/CentOS-Base.repo
> - 列表项含义：
>   - [base]		   容器名称，一定要放在[]中
>   - name            容器说明，可以自己随便写
>   - mirrorlist      镜像站点，这个可以注释掉
>   - baseurl         我们的yum源服务器的地址。默认是CentOS官方的yum源服务器，是可以使用的，如果你觉得man可以改成你喜欢的yum源地址
>   - enabled        此容器是否生效，如果不写或写成enable=1都是生效，写成enable=0表示不生效
>   - gpgcheck      如果是1是指RPM的数字证书生效，如果是0则不生效
>   - gpgkey          数字证书的公钥文件保存位置。不用修改。



##### 5.3.2 yum命令

1、常用yum命令

**1）查询**

查询所有可用软件包列表

`yum list`



---

搜索服务器上所有和关键字相关的包

`yum search 关键字`



**2）安装**

> - yum -y install 包名
> - 选项：
>   - install		安装
>   - -y                自动回答yes



**3） 升级**

> - yum - y update [包名]
> - 选项：
>   - update		升级
>   - -y                  自动回答yes
> - 补充：不跟包名表示升级所有软件，**慎用**



**4）卸载**

> - yum -y remove 包名
> - 选项：
>   - remove	卸载
>   - -y              自动回答yes



2、YUM软件组管理命令



列出所有可用的软件组列表

`yum grouplist`

---



安装指定软件组，组名可以由grouplist查询出来

`yum groupinstall 软件组名`

---



卸载指定软件组

`yum groupremove 软件组名`





##### 5.3.3 光盘yum源搭建

1）挂载光盘

`mount /dev/cdrom /mnt/cdrom`

2) 让网络yum源文件失效

把CentOS-Base.repo,CentOS-Debuginfo.repo 和CentOS-Vault.repo三个文件后缀名改为别的值即可失效。

3）修改光盘yum源文件

`vi CentOS-Media.repo`

修改的文件内容

> - baseurl=file:///mnt/cdrom
> - #地址为你自己的光盘挂载地址
> - #把剩下两个不存在的地址注释
> - enable=1

#### 5.4 源码包管理

##### 5.4.1 源码包和RPM包的区别

1、区别

- 安装之前的区别：概念上的区别
- 安装之后的区别：安装位置不同

2、RPM包安装位置

- 是安装在默认位置中（下表代表通常情况下的文件位置，不绝对）

| 文件夹名称      | 内容                       |
| --------------- | -------------------------- |
| /etc/           | 配置文件安装目录           |
| /usr/bin/       | 可执行的命令安装目录       |
| /usr/lib/       | 程序所使用的函数库保存位置 |
| /usr/share/doc/ | 基本的软件使用手册保存位置 |
| /usr/share/man/ | 帮助文件保存位置           |



3、源码包安装位置

安装在指定位置当中，一般是/usr/local/软件名/



4、安装位置不同带来的影响

- RPM包安装的服务可以使用系统服务管理命令(service)来管理，例如RPM包安装的apache的启动方法是：
  - /etc/rc.d/init.d/httpd start
  - service httpd start



- 而源码包安装的服务则不能被服务管理命令管理，因为没有安装到默认路径中。所以只能用绝对路径进行服务的管理，如：
  - /usr/local/apache2/bin/apachectl start





##### 5.4.2 源码包安装过程

1、安装准备

- 安装C语言编译器gcc



2、安装过程

1. 下载源码包

2. 解压源码包

3. 进入解压缩目录

4. 查看INSTALL文件的安装说明，按照安装说明进行安装

   **以apache源码安装为例：**

   - ./configure  --prefix=PREFIX(PREFIX：安装目录)
   - make
   - make install
   - PREFIX/bin/apachectl start



3、卸载使用源码包安装的软件

`rm -rf 源码包安装路径`



### 5.5 脚本安装包

1、脚本安装包

- 脚本安装包并不是独立的软件包类型，常见安装的是源码包
- 是认为把安装过程写成了自动安装的脚本，只要执行脚本，定义简单的参数，就可以完成安装。
- 非常类似于Windows下软件的安装方式



2、Webmin的作用

- Webmin是一个基于Web的Linux系统管理界面。你就可以通过图形化的方式设置用户账号、Apache、DNS、文件共享等服务。



## 6 用户和用户组管理

 ### 6.1 用户配置文件

#### 6.1.1 用户信息文件 /etc/passwd

1、用户管理简介

> - 越是对服务器安全性要求高的服务器，越需要建立合理的用户权限登记制度和服务器操作规范。
> - 在Linux中主要是通过用户配置文件来查看和修改用户信息



---

2、/etc/passwd 

**一共七个字段**

> - 第一字段：用户名称
> - 第二字段：密码标志
> - 第三字段：UID(用户ID)
>   - 0：		          超级用户
>   - 1-499：          系统用户（伪用户）
>   - 500-65535：  普通用户
> - 第四字段：GID（用于初始组ID）
> - 第五字段：用户说明
> - 第六字段：家目录
>   - 普通用户：/home/用户名/
>   - 超级用户：/root/
> - 第七字段：登录之后的Shell



3、初始组和附加组

> - 初始组：就是指用户一登录就立刻拥有这个用户组的相关权限，每个用户的初始组只能有一个，一般就是和这个用户的用户名相同的组名作为这个用户的初始组。
> - 附加组：指用户可以加入多个其他的用户组，并拥有这些组的权限，附加组可以有多个。



4、Shell是什么

> - Shell就是Linux的命令解释器；
> - 在/etc/passwd当中，除了标准Shell是/bin/bash之外，还可以写如/sbin/nologin



#### 6.1.2 影子文件 /etc/shadow

**一共九个字段**

> - 第1字段：用户名
> - 第2字段：加密密码
>   - 加密算法升级为SHA512散列加密算法
>   - 如果密码位是“!!”或“*”代表没有密码，不能登录
> - 第3字段：密码最后一次修改日期
>   - 使用1970年1月1日作为标准时间，每过一天时间戳加1
> - 第4字段：两次密码的修改间隔时间（和第3字段相比）
> - 第5字段：密码有效期（和第3字段相比）
> - 第6字段：密码修改到期前的警告天数（和第5字段相比）
> - 第7字段：密码过期后的宽限天数（和第5字段相比）
>   - 0：密码过期后立即失效
>   - -1：密码永远不会失效
> - 第8字段：账号失效时间（时间戳表示）
> - 第9字段：保留字段







#### 6.1.3 组信息文件 /etc/group和组密码文件 /etc/gshadow

1、组信息文件 /etc/group

**一共4个字段**

> - 第1字段：组名
> - 第2字段：组密码标志
> - 第3字段：GID
> - 第4字段：组中附加用户



2、组密码文件 /etc/gshadow

**一共4个字段**

> - 第1个字段：组名
> - 第2个字段：组密码
> - 第3个字段：组管理员用户名
> - 第4个字段：组中附加用户



 

### 6.2 用户管理相关文件

1、用户的家目录

> - 普通用户：/home/用户名/，所有者和所属组都是此用户，权限是700
> - 超级用户：/root/，所有者和所属组都是root用户，权限是550

2、用户的邮箱

- /var/spool/mail/用户名/



3、用户模板目录

- /etc/skel/：每新建一个用户，新建的用户的家目录会同步该文件夹下的文件



### 6.3 用户管理命令

##### useradd：用户添加命令

> - useradd [选项] 用户名
> - 选项：
>   - -u UID：              手工指定用户的UID号
>   - -d 家目录：         手工指定用户的家目录
>   - -c 用户说明：      手工指定用户的说明
>   - -g 组名：              手工指定用户的初始组
>   - -G 组名：             指定用户的附加组
>   - -s shell：              手工指定用户的登录shell

补充：

- 用户默认值文件：
  - /etc/default/useradd
  - /etc/login.dfs





---

##### passwd：修改用户密码

> - passwd [选项] 用户名
> - 选项：
>   - -S		查询用户密码的密码状态。仅root用户可用
>   - -l          暂时锁定用户。仅root用户可用
>   - -u         解锁用户。仅root用户可用
>   - --stdin     可以通过管道符输出的数据作为用户的密码



---

##### usermod：修改用户信息

> - usermd [选项] 用户名
> - 选项与useradd基本通用：
>   - -L	锁定用户
>   - -U    解锁用户



---

##### chage：修改用户信息

> - chage [选项] 用户名
> - 选项：
>   - -l：		       列出用户的详细密码状态
>   - -d 日期：     修改密码最后一次更改日期（shadow3字段）
>   - -m 天数：    两次密码修改间隔（4字段）
>   - -M 天数：     密码有效期（5字段）
>   - -W 天数：     密码过期前警告天数（6字段）
>   - -I 天数：        账号过后宽限天数（7字段）
>   - -E 日期：       账号失效时间（8字段）



---

##### userdel：删除用户

> - userdel [-r] 用户名
> - 选项：
>   - -r		删除用户的同时删除用户家目录



---

##### id：查看用户相关ID

- id 用户名



---

##### su：用户切换

> - su [选项] 用户名
> - 选项：
>   - -：	选项只使用“-”代表连带用户的环境变量一起切换
>   - -c：  仅执行一次命令，而不切换用户身份



### 6.4 用户组管理命令

1、添加用户组

> - groupadd [选项] 组名
> - 选项：
>   - -g GID:	指定组ID



---

2、修改用户组

> - groupmod [选项] 组名
> - 选项：
>   - -g GID：	     修改组ID
>   - -n 新组名：    修改组名



---

3、删除用户组

- groupdel 组名



---

4、把用户添加入组或从组中删除

> - gpasswd 选项 组名
> - 选项：
>   - -a 用户名：	把用户加入组
>   - -d 用户名：    把用户从组中删除



## 7 权限管理

### 7.1 ACL权限

#### 7.1.1 ACL 权限简介与开启

1、查看分区ACL权限是否开启（默认所有分区ACL权限是开启的）

> - dumpe2fs -h 分区路径
> - 选项：
>   - -h	仅显示超级块中信息，而不显示磁盘块组的详细信息



#### 7.1.2 查看与设定ACL权限

1、查看ACL命令

> - getfacle 文件名



---

2、设定ACL权限的命令

> - setfacl 选项 文件名
> - 选项：
>   - -m		设定ACL权限
>   - -x          删除指定的ACL权限
>   - -b          删除所有的ACL权限
>   - -d          设定默认ACL权限
>   - -k           删除默认ACL权限
>   - -R          递归设定ACL权限



3、给用户设定ACL权限

> - setfacl -m u:用户名:权限 文件夹



4、给用户组设定ACL权限

> - setfacl -m g:组名:权限 文件夹

#### 7.1.3 最大有效权限与删除ACL权限

1、最大有效权限mask

- mask是用来指定最大有效权限的。如果我给用户赋予了ACL权限，是需要和mask的权限“相与”才能得到用户的真正权限

2、修改最大有效权限

> - setfacl -m m:权限 文件名

3、删除ACL权限

**删除指定用户的ACL权限**

>- setfacl -x u:用户名 文件名



**删除指定用户组的ACL权限**

>- setfacl -x g:组名 文件名



**删除文件所有的ACL权限**

>- setfacl -b文件名



#### 7.1.4 默认ACL权限和递归ACL权限

1、递归ACL权限

> - 递归是父目录在设定ACL权限时，所有的子文件和子目录也会拥有相同的ACL权限。
> - setfacl -m u:用户名:权限 -R 目录名



2、默认ACL权限

> - 默认ACL权限的作用是如果给父目录设定了默认ACL权限，那么父目录中所有新建的子文件都会集成父目录的ACL权限。
> - setfacl -m d:u:用户名:权限 目录名





### 7.2 文件特殊权限

#### 7.2.1 SetUID

> - 只有可以执行的二进制程序才能设定SUID权限
> - 命令执行者要对该程序拥有x（执行）权限
> - 命令执行者在执行该程序时获得该程序文件属主的身份（在执行程序的过程中灵魂附体为文件的属主）
> - SetUID权限只在该程序执行过程中有效，也就是说身份改变只在程序执行过程中有效



2、设定SetUID的方法

> - 4代表SUID
>   - chmod 4755 文件名
>   - chmod u+s 文件名



3、取消SetUID的方法

> - chmod 755 文件名
> - chmod u-s 文件名



#### 7.2.2 SetGID

1、SetGID针对文件的作用

> - 只有可执行的二进制程序才能设置SGID权限
> - 命令执行者要对该程序拥有x（执行）权限
> - 命令执行者在执行程序的时候，组身份升级为该程序文件的属组
> - SetGID权限同样只在该程序执行过程中有效，也就是说组身份改变只在程序执行过程中有效



2、SetGID针对目录的作用

> - 普通用户必须对此目录拥有r和x权限，才能进入此目录
> - 普通用户在此目录中的有效组会变成此目录的属组
> - 若普通用户对此目录拥有w权限时，新建的文件的默认属组是这个目录的属组



3、设定SetGID

> - 2代表SUID：
>   - chmod 2755 文件名
>   - chmod g+s 文件名



4、取消SetGID

> - chmod 755 文件名
> - chmod g-s 文件名





#### 7.2.3 Sticky BIT

1、SBIT粘着位作用

> - 黏着位目前**只对目录有效**
> - 普通用户对该目录拥有w和x权限，即普通用户可以再此目录拥有写入权限
> - 如果没有黏着位，因为普通用户拥有w权限，所以可以删除此目录下所有文件，包括其他用户建立的文件。一旦赋予了黏着位，除了root可以删除所有文件，普通用户就算拥有w权限，也只能删除自己建立的文件，但是不能删除其他用户建立的文件



2、设置与取消黏着位

> - 设置黏着位
>   - chmod 1775 目录名
>   - chmod o+t 目录名
> - 取消黏着位
>   - chmod 777 目录名
>   - chmod o-t 目录名





### 7.3 文件系统属性chattr权限（主要用于防止误操作）

1、chattr命令格式

> - chattr [+-=] [选项] 文件或目录名
>   - +：增加权限
>   - -：删除权限
>   - =：等于某权限
> - 选项：
>   - i：如果对文件设置i属性，那么不允许对文件进行删除、改名，也不能添加和修改数据；如果对目录设置i属性，那么只能修改目录下文件的数据，但不允许建立和删除文件。（对管理员root也生效）
>   - a：如果对文件设置a属性，那么只能在文件中增加数据，但是不能删除也不能修改数据；如果对目录设置a属性，那么只允许在目录中建立和修改文件，但是不允许删除



2、查看文件系统属性

> - lsattr 选项 文件名
> - 选项：
>   - -a		显示所有文件和目录
>   - -d        若目标是目录，仅列出目录本身的属性，而不是子文件的





### 7.4 系统命令sudo权限

1、sudo权限

> - root把本来只能超级用户执行的命令赋予普通用户执行。
> - sudo的操作对象是系统命令



## 8 文件系统管理

### 8.1 回顾分区和文件系统

1、分区类型

> - 主分区：总共最多只能分四个
> - 扩展分区：只能有一个，也算作主分区的一种，也就是说主分区加扩展分区最多有四个。但是扩展分区不能存储数据和格式化，必须再划分成逻辑分区才能使用
> - 逻辑分区：逻辑分区是在扩展分区中划分的，如果是IDE硬盘，Linux最多支持59个逻辑分区，如果是SCSI硬盘Linux最多支持11个逻辑分区



2、文件系统

> - ext2：是ext文件系统升级版本，Red Hat Linux7.2版本以前的系统默认都是ext2文件系统。1993年发布，最大支持16TB的分区和最大2TB的文件
> - ex3：ext3文件系统是ext2文件系统的升级版本，最大的区别就是带**日志功能**，以在系统突然停止时提高文件系统的可靠性。支持最大16TB的分区和最大2TB的文件。
> - ext4：它是ext3文件系统的升级版。ext4在性能、伸缩性和可靠性方面进行了大量改进。EXT4的变化可以说是翻天腹地的，比如向下兼容EXT3、最大1EB文件系统和16TB文件、无线数量子目录、Extents连续数据块概念、多块分配、延迟分配、持久预分配、快速FSCK、日志校验、无日志模式、在线碎片整理、inode增强、默认启用barrier等。是CentOS 6.3的默认文件系统





### 8.2 文件系统常用命令

#### 8.2.1 df命令、du命令、fsck命令和dump2fs命令

**1、文件系统查看命令df**

> - df [选项] [挂载点]
> - 选项：
>   - -a：显示所有的文件系统信息，包括特殊文件系统，如/proc、/sysfs
>   - -h：使用习惯单位显示容量，如KB，MB或GB等
>   - -T：显示文件系统类型
>   - -m：以MB为单位显示容量
>   - -k：以KB为单位显示容量。默认就是以KB为单位





**2、统计目录或文件大小**

> - du [选项] [目录或文件名]
> - 选项：
>   - -a：显示每个子文件的磁盘占用量。默认只统计子目录的磁盘占用量
>   - -h：使用习惯单位显示磁盘占用量，如KB，MB或GB等
>   - -s：统计总占用量，而不列出子目录和子文件的占用量



---

du命令和df命令的区别

> - df命令是从文件系统考虑的，不光要考虑文件占用的空间，还要统计被命令或程序占用的空间（最常见的就是文件已经删除，但是程序并没有释放空间）
> - du命令是面向文件的，只会计算文件或目录占用的空间



3、文件系统修复命令fsck

> - fsck [选项] 分区设备文件名
> - 选项：
>   - -a：不用显示用户提示，自动修复文件系统
>   - -y：自动修复。和-a作用一致，不过有些文件系统只支持-y



4、显示磁盘状态命令dumpe2fs

> - dumpe2fs 分区设备文件名





#### 8.2.2 挂载命令

**1、查询与自动挂载**

查询系统中已经挂载的设备，-l会显示卷标名称:

> - mount [-l]



依据配置文件/etc/fstab的内容，自动挂载:

> - mount -a



2、挂载命令格式

> - mount [选项] 设备文件名 挂载点
> - 选项：
>   - -t 文件系统：	加入文件系统类型来指定挂载的类型，可以是ext3、ext4、iso9660等文件系统
>   - -L 卷标名：       挂载指定卷标的分区，而不是安装设备文件名挂载
>   - -o 特殊选项：   可以指定挂载的额外选项







#### 8.2.3 挂载光盘与U盘

1、挂载光盘

> 1)  建立挂载点
>
> ​		mkdir /mnt/cdrom
>
> 2)  挂载光盘
>
> ​		mount /dev/cdrom /mnt/cdrom
>
> ​	或 mount /dev/sr0 /mnt/cdrom



2、卸载命令

`umount 设备文件名或挂载点`



3、挂载U盘

> - fdisk -l
> - #查看U盘设备文件名



> - mount -t vfat /dev/sdb1 /mnt/usb/



注意：Linux系统默认不支持NTFS文件系统



#### 8.2.4 支持NTFS文件系统

1、下载NTFS-3G插件

http://www.tuxera.com/community/ntfs-3g-download/



2、安装NTFS-3G

> 1. tar -zxvf 安装包全名
>
>    **解压**
>
> 2. cd 解压目录
>
>    **进入解压目录**
>
> 3.  ./configure
>
>    **编译器准备。没有指定安装目录，安装到默认位置**
>
> 4. make
>
>    **编译**
>
> 5. make install
>
>    **编译安装**



3、使用

`mount -t ntfs-3g 分区设备文件名 挂载点`





### 8.3 fdisk分区

#### 8.3.1 fdisk命令分区过程

1、添加新硬盘

​	工具栏 -> 虚拟机 -> 设置 -> 添加 -> 硬盘 。。



2、查看硬盘信息

`fdisk -l`



3、使用fdisk命令分区

`fdisk /dev/sdb`



4、重新读取分区表信息

`partprobe`



5、格式化分区

`mkfs -t ext4 /dev/sdb1`



6、建立挂载点并挂载

> - mkdir  /disk1
> - mount /dev/sdb1 /disk1/





#### 8.3.2 分区自动挂载与fstab文件修复

1、/etc/fstab 文件

> - 第1字段：分区设备文件名或UUID（硬盘通用唯一识别码）
> - 第2字段：挂载点
> - 第3字段：文件系统名称
> - 第4字段：挂载参数
> - 第5字段：指定分区是否被dump备份，0表示不备份，1表示每天备份，2表示不定期备份
> - 第6字段：指定分区是否被fsck检测，0代表不检测，其他数字代表检测的优先级，那么当然1的优先级比2高



2、分区自动挂载

`vi /etc/fstab`



3、/etc/fstab文件修复

`mount -o remount,rw /`





### 8.4 分配swap分区

1、free命令

[root@localhost~]# free

#查看内存与swap分区使用状况

- cached（缓存）：是指把读取出来的数据保存在内存当中，当再次读取时，不用读取硬盘而直接从内存当中读取，加速了数据的读取过程
- buffer（缓冲）：是指在写入数据时，先把分散的写入操作保存到内存当中，当达到一定程度再集中写入硬盘，减少了磁盘碎片和硬盘的反复寻道，加速了数据的写入过程





## 第九章 Shell基础

### 9.1 概述

1、Shell是什么

> - Shell是一个**命令行解释器**，它为用户提供了一个向Linux内核发送请求以便运行程序的界面系统级程序，用户可以用Shell来启动、挂起、停止甚至是编写一些程序。
> - Shell还是一个功能相当强大的**编程语言**，易编写，易调试，灵活性较强。Shell是解释执行的脚本语言，在**Shell中可以直接调用Linux系统命令**





2、Shell的分类

> - Bourne Shell：从1979年起Unix就开始使用Bourne Shell，Bourne Shell的主文件名为sh。
> - C Shell：C Shell主要在BSD版的Unix系统中使用，其语法和C语言相类似而得名



> - Shell的两种主要语法类型有Bourne和C，这两种语法彼此不兼容。Bourne家族主要包括sh、ksh、Bash、psh、zsh；C家族主要包括：csh、tcsh
> - Bash：Bash与sh兼容，现在使用的Linux就是使用Bash作为用户的基本Shell





3、Linux支持的Shell

- /etc/shells





### 9.2 Shell脚本的执行方式

1、echo输出命令

> - echo [选项] [输出内容]
> - 选项：
>   - -e：	支持反斜杠控制的字符转换



| 控制字符 | 作用                                                         |
| -------- | ------------------------------------------------------------ |
| \\\      | 输出\本身                                                    |
| \a       | 输出警告音                                                   |
| \b       | 退格键，也就是向左删除键                                     |
| \c       | 取消输出行末的换行符。和“-n”选项一致                         |
| \e       | ESCAPE键                                                     |
| \f       | 换页符                                                       |
| \n       | 换行符                                                       |
| \r       | 回车键                                                       |
| \t       | 制表符，也就是Tab键                                          |
| \v       | 垂直制表符                                                   |
| \0nnn    | 按照八进制ASCII码表输出字符。其中0为数字零，nnn是三位八进制数 |
| \xhh     | 按照十六进制ASCII码表输出字符。其中hh是两位十六进制数        |



例：

> - `echo -e "\e[1;31m abcd \e[0m"`
>
>   #输出颜色
>
>   #30m=黑色，31m=红色，32m=绿色，33m=黄色，34m=蓝色，35m=洋红，36m=青色，37m=白色



2、编写脚本

脚本文件内第一行要写为：

- #!/bin/bash

用于声明该文件是脚本文件



3、脚本执行

两种执行方式

> - 通过Bash调用执行脚本
>   - bash hello.sh
> - 赋予执行权限，直接运行
>   - chmod 755 hello.sh
>   - 绝对路径或相对路径(./hello.sh)执行







### 9.3 Bash的基本功能

#### 9.3.1 历史命令与命令补全

1、历史命令

> - `history [选项] [历史命令保存文件]`
> - 选项：
>   - -c：清空历史命令
>   - -w：把缓存中的历史命令写入历史命令保存文件 ~/.bash_history



> - 历史命令默认会保存1000条，可以在环境变量配置文件/etc/profile中进行修改



历史命令的调用

> - 使用上、下箭头调用以前的历史命令
> - 使用"!n"重复执行第n条历史命令
> - 使用"!!" 重复执行上一条命令
> - 使用"!字串"重复执行最后一条以该字串开头的命令



2、命令与文件补全

> - 在Bash中，命令与文件补全是非常方便与常用的功能，我们只要在输入命令或文件时，按“Tab”键就会自动进行补全





#### 9.3.2 命令别名与常用快捷键

**1、命令别名**

设定命令别名：

`alias别名='原命令'`



---

查询命令别名列表：

`alias`



---

**命令执行时顺序**

> 1. 第一顺位执行用绝对路径或相对路径执行的命令；
> 2. 第二顺位执行别名
> 3. 第三顺位执行Bash的内部命令
> 4. 第四顺位执行按照$PATH环境变量定义的目录查找顺序找到的第一个命令



---

**让别名永久生效**

`vi /root/.bashhrc`

#上述文件是root用户的别名文件，对应用户的别名文件应去对应用户的目录下去找



---

删除别名

`unalias 别名`





2、Bash常用快捷键

| 快捷键     | 作用                                                         |
| ---------- | ------------------------------------------------------------ |
| ctrl+a     | 把光标移动到命令行开头。如果我们输入的命令过长，想要把光标移动到命令行开头时使用。 |
| ctrl+e     | 把光标移动到命令行结尾                                       |
| **ctrl+c** | 强制终止当前的命令                                           |
| **ctrl+l** | 清屏，相当于clear                                            |
| **ctrl+u** | 删除或剪切光标之前的命令。                                   |
| ctrl+k     | 删除或剪切光标之后的命令。                                   |
| **ctrl+y** | 粘贴ctrl+u或ctrl+k剪切的内容。                               |
| **ctrl+r** | 在历史命令中搜索，按下ctrl+r之后，就会出现搜索界面，只要输入搜索内容，就会从历史命令中搜索。 |
| **ctrl+d** | 退出当前终端。相当于logout。                                 |
| ctrl+z     | 暂停，并放入后台。                                           |
| ctrl+s     | 暂停屏幕输出。                                               |
| ctrl+q     | 恢复屏幕输出。                                               |



#### 9.3.3 输入输出重定向

1、标准输入输出

| 设备   | 设备文件名  | 文件描述符 | 类型         |
| ------ | ----------- | ---------- | ------------ |
| 键盘   | /dev/stdin  | 0          | 标准输入     |
| 显示器 | /dev/sdtout | 1          | 标准输出     |
| 显示器 | /dev/sdterr | 2          | 标准错误输出 |



2、输出重定向

![](D:\java\学习资料\设计模式\img\输出重定向.png)





3、输入重定向

> - 命令<文件              把文件作为命令的输入





#### 9.3.4 多命令顺序执行与管道符

1、多命令顺序执行

| 多命令执行符 | 格式           | 作用                                                         |
| ------------ | -------------- | ------------------------------------------------------------ |
| ；           | 命令1；命令2   | 多个命令顺序执行，命令之间没有任何逻辑联系                   |
| &&           | 命令1&&命令2   | **逻辑与**。当命令1正确执行，则命令2才会执行；当命令1执行不正确，则命令2不会执行 |
| \|\|         | 命令1\|\|命令2 | **逻辑或**。当命令1执行不正确，则命令2才会执行；当命令1正确执行，则命令2不会执行； |



**指定输入输出源，按照规则传递数据：**

> - `dd if=输入文件 of=输出文件 bs=字节数 count=个数`
> - 选项：
>   - if=输入文件		指定源文件或源设备
>   - of=输出文件       指定目标文件或目标设备
>   - bs=字节数          指定一次输入/输出多少字节，即把这些字节看做一个数据块
>   - count=个数        指定输入/输出多少个数据块





2、管道符



> 命令1的正确输出作为命令2的操作对象：
>
> - `命令1 | 命令2`





#### 9.3.5 通配符与其他特殊符号

1、通配符

| 通配符 | 作用                                                         |
| :----: | ------------------------------------------------------------ |
|   ？   | 匹配一个任意字符                                             |
|   *    | 匹配0个或任意多个任意字符，也就是可以匹配任何内容            |
|   []   | 匹配中括号中任意一个字符。例如：[abc]代表一定匹配一个字符，或者是a，或者是b，或者是c。 |
|  [-]   | 匹配中括号中任意一个字符，- 代表一个范围。例如：[a-z]代表匹配一个小写字母。 |
|  [^]   | **逻辑非**。表示匹配不是中括号内的一个字符。例如：匹配中括号中任意一个字符，- 代表一个范围。例如：\[^a-z]代表匹配一个小写字母。代表匹配一个小写字母。 |





2、Bash中其他特殊符号

| 符号 | 作用                                                         |
| :--: | ------------------------------------------------------------ |
| ' '  | 单引号。在单引号中的所有特殊符号，如”$“和”`“（反引号）都没有特殊含义。 |
| " "  | 双引号。在双引号中特殊符号都没有特殊含义，但是”$“、”`“和“\”是例外，拥有“调用变量的值”、“引用命令”和“转义符”的特殊含义。 |
|  ``  | 反引号。反引号括起来的内容是系统命令，在Bash中会先执行它。和$()作用一样，不过推荐使用$()，因为反引号非常容易看错。 |
| $()  | 和反引号作用一样，用来引用系统命令。                         |
|  #   | 在Shell脚本中，#开头的行表示注释                             |
|  $   | **用于调用变量的值**。比如需要调用变量name的值时，需要用$name的方式得到变量的值。 |
|  \   | **转义符**。跟在\之后的特殊符号将失去特殊含义，变为普通字符。 |



### 9.4 Bash的变量

#### 9.4.1 用户自定义变量



1、变量设置规则

> - 变量名称可以由字母、数字和下划线组成，但是**不能以数字开头**。
> - 在Bash中，变量的默认类型都是字符串型，如果要进行数值运算，则必须制定变量类型为数值型。
> - 变量用等号连接值，等号左右两侧不能有空格。
> - 变量的值如果有空格，需要使用单引号或双引号包括。
> - 在变量的值中，可以使用“\“ 转义符。
> - 如果需要增加变量的值，那么可以进行变量值得叠加。不过变量需要用双引号包含“$变量名”或用${变量名}包含。
> - 如果是把命令的结果作为变量值赋予变量，则需要使用反引号或$()包含命令。
> - 环境变量名建议大写，便于区分。





2、变量分类

> - 用户自定义变量（也称本地变量）
> - 环境变量：这种变量中主要保存的是和系统操作环境相关的数据。
> - 位置参数变量：这种变量主要是用来向脚本当中传递参数或数据的，变量名不能自定义，变量作用是固定的。
> - 预定义变量：是Bash中已经定义好的变量，变量名不能自定义，变量作用也是固定的。





3、本地变量

> - 变量定义：
>
>   `name=linkin`
>
> - 变量叠加：
>
>   ```shell
>   aa=123
>   aa="$aa"456
>   aa=${aa}789
>   ```
>
> - 变量调用
>
>   `echo $name`
>
> - 所有变量查看
>
>   `set`
>
> - 变量删除
>
>   `unset name`





#### 9.4.2 环境变量

1、环境变量是什么

- 用户自定义变量只在当前的Shell中生效，而环境变量会在当前Shell和这个Shell的所有子Shell当中生效。如果把环境变量写入相应的配置文件，那么这个环境变量就会在所有的Shell中生效





2、设置环境变量



> - 申明变量：
>   - `export 变量名=变量值`
> - 查询变量：
>   - `env`
> - 删除变量：
>   - `unset 变量名`







#### 9.4.3 位置参数变量

| 位置参数变量 | 作用                                                         |
| ------------ | ------------------------------------------------------------ |
| $n           | n为数字，$0代表命令本身，$1-$9代表第一道第九个参数，十以上的阐述需要用大括号包含，如${10} |
| $*           | 这个变量代表命令行中所有的参数，$***把所有的参数看成一个整体** |
| $@           | 这个变量也代表命令行中所有的参数，不过$@**把每个参数区分对待** |
| $#           | 这个变量代表命令行中**所有参数的个数**                       |



#### 9.4.4 预定义变量

1、预定义变量

| 预定义变量 | 作用                                                         |
| :--------: | ------------------------------------------------------------ |
|     $?     | 最后一次执行的命令的返回状态。如果这个变量的**值为0，证明上一个命令正确执行**；如果这个变量的值为非0（具体是哪个数，由命令自己来决定），则证明上一个命令执行不正确 |
|     $$     | 当前进程的进程号（PID）                                      |
|     $!     | 后台运行的最后一个进程的进程号（PID）                        |



2、接收键盘输入

> - `read [选项] [变量名]`
> - 选项：
>   - -p “提示信息”：    在等待read输入时输出提示信息
>   - -t 秒数：               read命令会一直等待用户输入，使用此选项可指定等待时间
>   - -n 字符数：          read命令只接收指定的字符数，就会自动执行
>   - -s                           隐藏输入的数据，适用于机密信息的输入





### 9.5 Bash的运算符

#### 9.5.1 数字运算与运算符

1、declare声明变量类型

> - `declare [+/-][选项] 变量名`
> - 选项：
>   - \- 		给变量设定类型属性
>   - \+        取消变量的类型属性
>   - -i        将变量声明为整数型（integer）
>   - -x       将变量声明为环境变量
>   - -p       显示指定变量的被声明的类型



2、数值运算



方法一：declare声明为数值型

~~~shell
aa=11
bb=22
declare -i cc=$aa+$bb
~~~



方法二：expr或let数值运算工具

~~~shell
aa=11
bb=22
#给变量aa和变量bb赋值
dd=$(expr $aa + $bb)
#dd的值是aa和bb的和。注意“+”号左右两侧必须有空格
~~~



**方法三："$((运算式))"或"$[运算式]"    （最常用）**

~~~shell
aa=11
bb=22
ff=$(($aa+$bb))
gg=$[$aa+$bb]
~~~



3、运算符

| 优先级（数值越大优先级越高） |                    运算符                    | 说明                           |
| :--------------------------: | :------------------------------------------: | ------------------------------ |
|              13              |                     -，+                     | 单目负、单目正                 |
|              12              |                    ！，~                     | 逻辑非、按位取反或补码         |
|              11              |                   *，/，%                    | 乘、除、取模                   |
|              10              |                     +，-                     | 加、减                         |
|              9               |                    <<，>>                    | 按位左移、按位右移             |
|              8               |                 <=，>=，<，>                 | 小于等于、大于等于、小于、大于 |
|              7               |                   ==，！=                    | 等于、不等于                   |
|              6               |                      &                       | 按位与                         |
|              5               |                      ^                       | 按位异或                       |
|              4               |                      \|                      | 按位或                         |
|              3               |                      &&                      | 逻辑与                         |
|              2               |                     \|\|                     | 逻辑或                         |
|              1               | =，+=，-=，*=，/=，%=，&=，^=，\|=，<<=，>>= | 赋值、运算且赋值               |



#### 9.5.2 变量测试与内容替换（不需记住：知道即可）

| 变量置换方式 | 变量y没有设置                      | 变量y为空值            | 变量y设置值   |
| ------------ | ---------------------------------- | ---------------------- | ------------- |
| x=${y-新值}  | x=新值                             | x为空                  | x=$y          |
| x=${y:-新值} | x=新值                             | x=新值                 | x=$y          |
| x=${y+新值}  | x为空                              | x=新值                 | x=新值        |
| x=${y:+新值} | x为空                              | x为空                  | x=新值        |
| x=${y=新值}  | x=新值；y=新值                     | x为空；y值不变         | x=$y；y值不变 |
| x=${y:=新值} | x=新值；y=新值                     | x=新值；y=新值         | x=$y；y值不变 |
| x=${y?新值}  | 新值输出到标准错误输出（就是屏幕） | x为空                  | x=$y          |
| x=${:y?新值} | 新值输出到标准错误输出             | 新值输出到标准错误输出 | x=$y          |







### 9.6 环境变量配置文件

---

#### 9.6.1 环境变量配置文件简介

1、source命令（让配置文件生效）

> - 方式一：
>
>   source 配置文件
>
> - 方式er：
>
>   . 配置文件



2、环境变量配置文件简介

> 环境变量配置文件中主要是定义对系统的操作环境生效的系统默认环境变量，比如PATH、HISTSIZE、PS1、HOSTNAME等默认环境变量。





**五个环境变量配置文件**：

前三个对所有用户生效，后俩个对指定用户生效

> - /etc/profile
> - /etc/profile.d/*.sh
> - /etc/bashrc
> - ~/.bash_profile
> - ~/.bashrc





#### 9.6.2 环境变量配置文件作用

<img src="D:\java\学习资料\Linux\img\环境变量调用顺序.png" style="zoom:80%;" />





**/etc/profile的作用：**

> - USER变量：
> - LOGNAME变量：
> - MAIL变量：
> - PATH变量：
> - HOSTNAME变量：
> - HISTSIZE变量：
> - umask：
> - 调用/etc/profile.d/*.sh文件









#### 9.6.3 其他配置文件和登录信息



1、注销时生效的环境变量配置文件

- ~/.bash_logout





2、其他配置文件



**历史操作记录文件：**

- ~/bash_history



3、Shell登录信息

- 本地终端欢迎信息：/etc/issue

| 转义符 | 作用                           |
| :----: | ------------------------------ |
|   \d   | 显示当前系统日期               |
|   \s   | 显示操作系统名称               |
|   \l   | 显示登录的终端号，这个比较常用 |
|   \m   | 显示硬件体系结构，如i386、i686 |
|   \n   | 显示主机名                     |
|   \o   | 显示域名                       |
|   \r   | 显示内核版本                   |
|   \t   | 显示当前系统时间               |
|   \u   | 显示当前登录用户的序列号       |





> - 远程终端欢迎信息：/etc/issue.net
>   - 转义符在该文件中不能使用
>   - 是否显示此欢迎信息，由ssh的配置文件/etc/ssh/sshd_config决定，加入“Banner/etc/issue.net”行才能显示（及得重启SSH服务）





> - 登录后欢迎信息：/etc/motd
>   - 不管是本地登录，还是远程登录，都可以显示此欢迎信息



## 第十章 Shell编程

### 10.1 基础正则表达式

1、正则表达式与通配符

> - 正则表达式用来在文件中匹配符合条件的字符串，正则是包含匹配。grep、awk、sed等命令可以支持正则表达式
> - 通配符用来匹配符合条件的文件名，通配符是完全匹配。ls、find、cp这些命令不支持正则表达式，所以只能使用shell自己的通配符来进行匹配了。



2、基础正则表达式

|  元字符   | 作用                                                         |
| :-------: | ------------------------------------------------------------ |
|     *     | 前一个字符匹配**0次**或**任意多次**                          |
|     .     | 匹配除了换行符外任意一个字符                                 |
|     ^     | 匹配行首。例如：^hello会匹配以hello开头的行。                |
|     $     | 匹配行尾。例如：hello&会匹配以hello结尾的行。                |
|    []     | 匹配中括号中指定的任意一个字符，只匹配一个字符。例如：[0-9]匹配任意一位数字，\[a-z][0-9]匹配小写字和一位数字构成的两位字符。 |
|    [^]    | 匹配除中括号中代表的字符以外的任意一个字符。例如：\[^0-9]匹配任意一位非数字字符 |
|     \     | 转义符。用于取消特殊符号的含义                               |
|  \\{n\\}  | 表明其前面的字符恰好出现n次。例如：[0-9]\\{4\\}匹配4位数字，\[1]\[3-8]\[0-9]\\{9\\}匹配手机号码 |
| \\{n,\\}  | 表示其前面的字符出现不少于n次。例如：[0-9]\\{2,\\}表示两位及其以上的数字。 |
| \\{n,m\\} | 表示其前面的字符至少出现n次，最多出现m次。例如：[a-z]\\{6,8\\}匹配6到8位的小写字母。 |





### 10.2 字符截取命令

---

#### 10.2.1 cut字段提取命令



> - `cut [选项] 文件名`
> - 选项：
>   - -f 列号：		提取第几列
>   - -d 分隔符：   按照指定分隔符分隔列





#### 10.2.2 printf命令

> - `printf '输出类型输出格式' 输出内容`
> - 输出类型：
>   - %ns：	输出字符串。n是数字指代输出几个字符
>   - %ni：     输出整数。n是数字指代输出几个数字
>   - %m.nf：  输出浮点数。m和n是数字，指代输出的总位数和小数位数。如%8.2f代表共输出8位数，其中2位是小数，6位是整数。
> - 输出格式：
>   - \a:		输出警告声音
>   - \b:        输出退格键，也就是Backspace键
>   - \f:         清除屏幕
>   - \n:        换行
>   - \r:         回车，也就是Enter键
>   - \t:         水平输出退格键，也就是Tab键
>   - \v:         垂直输出退格键，也就是Tab键



#### 10.2.3 awk命令



> - `awk '条件1{动作1} 条件2{动作2}...' 文件名`
> - 常用附加选项：
>   - BEGIN {指令B} : 	先执行指定指令B在执行后续动作
>   - FS内置变量：     指定分隔符
>   - END {指令N}：以指令N结束



例：

>  `awk 'BEGIN {FS=":"} {printf $1 “\t” $3 “\n” }'`
>
> - 说明：指定“:”为分隔符，打印每行第1列和第3列



#### 10.2.4 sed命令

> - sed是一种几乎包括在所有UNIX平台（包括Linux）的轻量级流编辑器。sed主要是用来将数据进行选取、替换、删除、新增的命令、



> - `sed [选项] '[动作]' 文件名`
> - 选项：
>   - -n：	一般sed命令会把所有数据都输出到屏幕，如果加入此选择则只会把经过sed命令处理的行输出到屏幕
>   - -e：    允许对输入数据应用多条sed命令编辑
>   - -i：      用sed的修改结果直接修改读取数据的文件，而不是由屏幕输出
> - 动作：
>   - a \：	追加，在当前行后添加一行或多行。添加多行时，除最后一行外，每行末尾需要用”\“代表数据未完成
>   - c \：    行替换，用c后面的字符串替换原数据行，替换多行时，除最后一行外，每行末尾需用”\“代表数据未完成
>   - i \：     插入，在当前行前插入一行或多行。插入多行时，除最后一行外，每行末尾需用”\“代表数据未完成
>   - d：     删除，删除指定的行。
>   - p：     打印，输出指定的行。
>   - s：     字串替换，用一个字符串替换另外一个字符串。格式为“行范围s/旧字串/新字串/g”（和vim中的替换格式类似）。



例：

> - `sed '2a hello' 文件名`
>
> #在第二行后追加hello
>
> - ```shell
>   sed '2i hello \
>   world' 文件名
>   ```
> ```
> 
> ```
>
> ```
> 
> ```
>
> ```
> 
> ```
>
> ```
> 
> ```
>
> ```
> 
> #在第二行前插入两行数据
> 
> - `sed -i '3s/74/99/g' 文件名`
> 
> #在第三行中，把74换成99，并把操作的数据直接写入文件
> 
> - `sed -e 's/Liming//g;s/Gao//g' 文件名`
> 
> #同时把“LIMing”和“Gao”替换为空
> 
> ```
>
> ```
> 
> ```
>
> ```
> 
> ```
>
> ```
> 
> ```
>
> ```
> 
> ```





### 10.3 字符处理命令

1、排序命令sort

> - `sort [选项] 文件名`
>
> - 选项：
>
>   - -f：	忽略大小写
>   - -n：   以数值型进行排序，默认使用字符串型排序
>   - -r：    反向排序
>   - -t：    指定分隔符，默认分隔符是制表符
>   - -k n[,m]：     按照指定的字段范围排序。从第n字段开始，m字段结束（默认到行尾）
>
> - 例：
>
>   `sort -t  ":" -k 3,3 /etc/passwd`
>
>   #指定分隔符为“:”,用第三字段开头，第三字段结尾排序，就是只用第三字段排序



2、统计命令wc

> - `wc [选项] 文件名`
> - 选项：
>   - -l：		只统计行数
>   - -w：      只统计单词数
>   - -m：     只统计字符数
> - #不加选项默认统计内容为：**行数 单词数 字符数**





### 10.4 条件判断

1、按照文件类型进行判断

| 测试文件    | 作用                                                         |
| ----------- | ------------------------------------------------------------ |
| -b 文件     | 判断该文件是否存在，并且是否为块设备文件（是块设备文件为真） |
| -c 文件     | 判断该文件是否存在，并且是否为字符设备文件（是字符设备文件为真） |
| **-d 文件** | **判断该目录文件是否存在（是目录文件为真）**                 |
| **-e 文件** | **判断该文件是否存在（存在为真）**                           |
| **-f 文件** | **判断该文件是否存在，并且是否为普通文件（是普通文件为真）** |
| -L 文件     | 判断该文件是否存在，并且是否为符号链接文件（是符号链接文件为真） |
| -p 文件     | 判断该文件是否存在，并且是否为管道文件（是管道文件为真）     |
| -s 文件     | 判断该文件是否存在，并且是否为空（非空为真）                 |
| -S 文件     | 判断该文件是否存在，并且是否为套接字文件（是套接字文件为真） |





**两种判断格式**

> 1. `test -e /root/install.log`
> 2. `[ -e /root/install.log ]`



3、两个文件之间进行比较

|    测试选项     | 作用                                                         |
| :-------------: | ------------------------------------------------------------ |
| 文件1 -nt 文件2 | 判断文件1的修改时间是否比文件2的新（如果新则为真）           |
| 文件1 -ot 文件2 | 判断文件1的修改时间是否比文件2的旧（如果旧则为真）           |
| 文件1 -ef 文件2 | 判断文件1是否和文件2的Inode号一致，可以理解为连个文件是否为同一个文件。这个判断用于判断硬链接是很好的方法 |



4、两个整数之间比较

> - -eq: 	判断相等
> - -ne：  判断不相等
> - -gt：   判断前面的数是否大于后面的数
> - -lt：    判断小于
> - -ge：  判断大于等于
> - -le：   判断小于等于



5、字符串的判断

| 测试选项     | 作用               |
| ------------ | ------------------ |
| -z 字串      | 判断字串是否为空   |
| -n 字串      | 判断字串是否非空   |
| 字串 == 字串 | 判断字串是否相等   |
| 字串 != 字串 | 判断字串是否不相等 |



6、多重条件判断

> - -a：逻辑与
> - -o：逻辑或
> - ！：逻辑非





### 10.5 流程控制

---

#### 10.5.1 if语句

1、单分支if条件语句

两种写法：

~~~shell
if [ 条件判断式 ];then
	程序
fi
~~~

或

~~~shell
if [ 条件判断式 ]
	then
		程序
fi		
~~~



单分支条件语句需要注意几个点

> - if语句使用fi结尾，和一般语言使用大括号结尾不同
> - [ 条件判断式 ]就是使用test命令判断，所以中括号和条件判断式之间必须有空格
> - then后面跟符合条件之后执行的程序，可以放在[]之后，用";"分割。也可以换行写入，就不需要“:“了





2、多分支if条件语句

~~~shell
if [ 条件判断式1 ]
	then
		条件1成立时，执行的语句
elif [ 条件判断式2 ]
	then
		条件2成立时，执行的语句
...
else
	当所有都条件不成立时，执行的语句
fi
~~~





#### 10.5.2 case语句

语法：

~~~shell
case $变量名 in
	"值1")
		值1时的执行程序
		;;
	"值2")
		值2时的执行程序
		;;
	省略其他分支...
	*)
		都不匹配的执行程序
		;;
esac			
~~~





#### 10.5.3 for循环

**两种语法**

语法一：

~~~shell
for 变量 in 值1 值2 值3 ...
	do
		程序(注：用$变量来表示循环中的变量)
	done
~~~



语法二：

~~~shell
for (( 初始值;循环控制条件;变量变化 ))
	do
		程序
	done
~~~



#### 10.5.4 while循环与until循环



while语法：

~~~shell
while [ 条件判断式 ]
	do
		程序
	done
~~~







until循环：

一旦循环条件成立，则终止循环

~~~shell
until [ 条件判断式 ]
	do
		程序
	done
~~~







## 第十一章 Linux服务管理

### 11.1 服务简介与分类

1、服务的分类

<img src="D:\java\学习资料\Linux\img\服务的分类.png" style="zoom:80%;" />



查询已安装的服务

> - RPM包安装的服务
>
>   - `chkconfig --list`
>
>      #查看服务自启动状态，可以看到所有**RPM**包安装的服务 
>
> - 源码包安装的服务
>
>   - 查看服务安装的位置，一般是/usr/local/下





### 11.2 RPM包安装服务的管理

#### 11.2.1 独立服务的管理

1、RPM包安装服务的位置

| 文件名                                           | 作用                       |
| ------------------------------------------------ | -------------------------- |
| /etc/init.d/（或/etc/rc.d/init.d/,l两者是软链接) | 启动脚本位置（独立的服务） |
| /etc/sysconfig/                                  | 初始化环境配置文件位置     |
| /etc/                                            | 配置文件位置               |
| /etc/xinetd.conf                                 | xinetd配置文件             |
| /etc/xinetd.d/                                   | 基于xinetd服务的启动脚本   |
| /var/lib/                                        | 服务产生的数据放在这里     |
| /var/log/                                        | 日志                       |



2、独立服务的启动

两种方式：

> - `/etc/init.d/独立服务名 start|stop|status|restart`
> - `service 独立服务名 start|stop|restart|status`





3、独立服务的自启动

三种方式

> - 1. `chkconfig [--level 运行级别] [独立服务名] [on|off]`
> - 2. 修改/etc/rc.d/rc.local文件（该文件用户登录后自动执行）
> - 3. 使用ntsysv命令管理自启动







#### 11.2.2 基于xinetd服务的管理

不重要



### 11.3 源码包安装与服务的管理

不推荐





### 11.4 服务管理总结 

![Linux服务启动方式](D:\java\学习资料\Linux\img\Linux服务启动方式.png)







**常见服务的作用**

| 服务名称        | 功能简介                                                     |  建议  |
| --------------- | ------------------------------------------------------------ | :----: |
| acpid           | 电源管理接口。如果是笔记本用户建议开启，可以监听内核层的相关电源事件。 |  开启  |
| anacron         | 系统的定时任务程序。cron的一个子系统，如果定时任务错过了执行时间，可以通过anacron继续环形执行。 |  关闭  |
| alsasound       | Alsa声卡驱动。如果使用alsa声卡，开启                         |  关闭  |
| apmd            | 电源管理模块。如果支持acpid，就不需要apmd，可以关闭          |  关闭  |
| atd             | 指定系统在特定时间执行某个任务，只能执行一次。如果需要则开启，但我们一般使用crond来进行循环定时任务。 |  关闭  |
| auditd          | 审核子系统。如果开启了此服务，SELinux的审核信息会写入/var/log/audit/audit.log文件，如果不开启，审核信息会记录在syslog中 |  开启  |
| autofs          | 让服务器可以自动挂载网络中的其他服务器的共享数据，一般用来自动挂载NFS服务。如果没有NFS服务建议关闭。 |  关闭  |
| avahi-daemon    | Avahi是zeroconf协议的实现。他可以在没有DNS服务的局域网里发现基于zeroconf协议的设备和服务。除非有兼容设备或使用zeroconf协议，否则关闭 |  关闭  |
| bluetooth       | 蓝牙设备支持。一般不会再服务器上启用蓝牙设备，关闭它         |  关闭  |
| capi            | 进队使用ISND设备的用户有用                                   |  关闭  |
| chargen-dgram   | 使用UDP协议的chargen server。主要功能是提供类似远程打字的功能。 |  关闭  |
| chargen-stream  | 同上                                                         |  关闭  |
| cpuspeed        | 可以用来调整CPU的频率。当闲置时可以自动降低CPU频率来节省电量 |  开启  |
| crond           | 系统的定时任务，一般的Linux服务器都需要定时任务帮助系统维护。建议开启。 |  开启  |
| cvs             | 一个版本控制系统                                             |  关闭  |
| daytime-dgram   | daytime使用TCP协议的Daytime守护进程，该协议为客户机实现从远程服务器获取日期和时间的功能。 |  关闭  |
| daytime-stream  | 同上                                                         |  关闭  |
| dovecot         | 邮件服务中心POP3/IMAP服务的守护进程。主要用来接收信件，如果启动了邮件服务则开启，否则关闭 |  关闭  |
| echo-dgram      | 服务器回信客户服务的进程                                     |  关闭  |
| echo-stream     | 同上                                                         |  关闭  |
| firstboot       | 系统安装完成之后，有个欢迎界面，需要对系统进程初始化设定。就是这个进程的作用。既然不是第一次启动了，关闭把 |  关闭  |
| gpm             | 在字符终端(tty1-tty6)中可以使用鼠标复制和粘贴。就是这个服务的功能。 |  开启  |
| haldaemon       | 检测盒支持USB设备。如果是服务器可以关闭，个人机建议开启      |  关闭  |
| hidd            | 蓝牙鼠标、键盘灯蓝牙设备检测。必须启动bluetooth服务。        |  关闭  |
| hplip           | HP打印机支持，如果没有HP打印机关闭吧                         |  关闭  |
| httpd           | apache服务的守护进程。如果需要启动Apache，就开启             |  开启  |
| ip6tables       | IPv6的防火墙，目前IPv6协议并没有使用，可以关闭               |  关闭  |
| iptables        | 防火墙功能，Linux中防火墙是内核支持功能。这是服务器的主要防护手段，必须开启 |  开启  |
| irda            | IrDA提供红外线设备（笔记本，PDA's，手机，计算器等）间的通讯支持。关闭吧 | 关闭吧 |
| irqbalance      | 支持多核处理器，让CPU可以自动分配系统终端（IRQ），提高系统性能。目前服务器多事多核CPU，请开启 |  开启  |
| isdn            | 使用ISDN设备连接网络。目前主流的联网方式是光纤接入和ADSL，ISDN已经非常少见，请关闭 |  关闭  |
| kudzu           | 该服务可以在开机时进行硬件检测，并会调用相关的设置软件。建议关闭，仅在需要时开启 |  关闭  |
| lvm2-monitor    | 该服务可以让系统支持LVM逻辑卷组，如果分区采用的是LVM方式，那么应该开启。建议开启 |  开启  |
| mcstrans        | SELinux的支持服务。建议启动                                  |  开启  |
| mdmonitor       | 该服务用来监测Software RAID或LVM的信息。不是必须服务，建议关闭 |  关闭  |
| mdmpd           | 该服务用来监测Multi-Path设备。不是必须服务                   |  关闭  |
| messagebus      | 这是Linux的IPC(Interprocess Communication,进程间通讯)服务，用来在各个软件中交换信息。个人建议关闭 |  关闭  |
| microcode_ctl   | Intel系列的CPU可以通过这个服务支持额外的徽指令集。           |  关闭  |
| mysqld          | mysql数据库服务器。如果需要就开启，否则关闭                  |  开启  |
| named           | DNS服务的守护进程，用来进行域名解析。如果是DNS服务器则开启，否则关闭 |  关闭  |
| netfs           | 该服务用于在系统启动时自动挂载网络中的共享文件空间，比如：NFS,Samba等。需要就开启，否则关闭 |  关闭  |
| network         | 提供网络设置功能。通过这个服务来管理网络，所以开启           |  开启  |
| nfs             | NFS(Network File System)服务，Linux与Linux之间的文件共享服务。需要就开启，否则关闭 |  关闭  |
| nfslock         | 在Linux中如果使用了NFS服务，为了避免同一个文件被不同的用户同时编辑，所以有这个锁服务。有NFS时开启，否则关闭 |  关闭  |
| ntpd            | 该服务可以通过互联网自动更新系统时间，使系统时间永远都精确。需要则开启，但不是必须服务 |  关闭  |
| pcscd           | 智能卡检测服务，可以关闭                                     |  关闭  |
| portmap         | 用在远程过程调用(RPC)的服务，如果没有任何RPC服务时，可以关闭。主要是NFS和NIS服务需要。 |  关闭  |
| psacct          | 该收获进程支持几个监控进程活动的工具                         |  关闭  |
| rdisc           | 客户端ICMP路由协议                                           |  关闭  |
| readahead_early | 在系统开机时，先将某些进程加载如内存调整，可以加快一点启动速度。 |  关闭  |
| readahead_early | 同上                                                         |  关闭  |
| restorecond     | 用于给SELinux检测和重新加载正确的文件上下文。如果开启SELinux则需要开启 |  关闭  |
| rpcgssd         | 与NFS有关的客户端功能。如果没有NFS就关闭吧                   |  关闭  |
| rpcidmapd       | 同上                                                         |  关闭  |
| rsync           | 远程数据备份收获进程                                         |  关闭  |
| sendmail        | sendmail邮件服务的守护进程。如果有邮件服务就开启，否则关闭   |  关闭  |
| setroubleshoot  | 该服务用于将SELinux相关信息记录在日志/var/log/messages中。建议开启。 |  关闭  |
| smartd          | 该服务用于自动检测硬盘状态。建议开启                         |  开启  |
| smb             | 网络服务samba的守护进程。可以让Linux和Windows之间共享数据。如果需要则开启 |  关闭  |
| squid           | 代理服务的守护进程。如果需要则开启，否则关闭                 |  关闭  |
| sshd            | ssh加密远程登陆管理的服务。服务器的远程管理必须使用此服务，不要关闭 |  开启  |
| syslog          | 日志的守护进程                                               |  开启  |
| vsftpd          | vsftp服务的守护进程。如果需要FTP服务则开启，否则关闭         |  关闭  |
| xfs             | 这个是X Window的字体守护进程。为图形界面提供字体服务，如果不启动图形界面，就不用开启 |  关闭  |
| xinetd          | 超级守护进程。如果有意拉xinetd的服务就必须开启               |  开启  |
| ypbind          | 为NIS（网络信息系统）客户机激活ypbind服务进程                |  关闭  |
| yum-updatesd    | yum的在线升级服务                                            |  关闭  |







## 第十二章 Linux系统管理

### 12.1 进程管理

---

#### 12.1.1 进程查看

1、进程简介

- 进程是正在执行的一个程序或命令，每一个进程都是一个运行的实体，都有自己的地址空间，并占用一定的系统资源。



2、进程管理的作用

> - 判断服务器健康状态
> - 查看系统中所有进程
> - 杀死进程



3、查看系统中所有进程

两种方式：

> - `ps aux`
> - `ps -le`



进程列表信息详情：

> - USER：该进程是由哪个用户产生
> - PID：进程ID号
> - %CPU：该进程占用CPU资源的百分比
> - %MEM：该进程占用物理内存的百分比
> - VSZ：该进程占用虚拟内存的大小，单位KB
> - RSS：该进程占用实际物理内存的大小，单位KB
> - TTY：该进程是在哪个终端中运行的。其中tty1-tty7代表本地控制台终端，tty1-tty6是本地的字符界面终端，tty7是图形终端。pts/0-255代表虚拟终端。
> - STAT：进程状态。常见的状态有：
>   1. R：运行
>   2. S：睡眠
>   3. T：停止状态
>   4. s：包含子进程
>   5. +：位于后台
> - START：该进程的启动时间
> - TIME：该进程占用CPU的运算时间，注意不是系统时间
> - COMMAND：产生此进程的命令名



4、查看系统健康状态

语法：

> - `top [选项]`
> - 选项：
>   - -d 秒数：指定top命令每隔几秒更新。默认是3秒



在top命令的交互模式中可执行的命令：

> - ?或h：		显示交互模式的帮助
> - P：             以CPU使用率排序，默认就是此项
> - M：            以内存的使用率排序
> - N：            以PID排序
> - q：             退出top





系统健康状态详情信息：

一、第一行信息为**任务队列信息**

二、第二行信息为**进程信息**

| 内容            | 说明                                      |
| --------------- | ----------------------------------------- |
| Tasks: 95 total | 系统中的进程总数                          |
| 1 running       | 正在运行的进程数                          |
| 94 sleeping     | 睡眠的进程                                |
| 0 stopped       | 正在停止的进程                            |
| 0 zombie        | 僵尸进程。如果不是0，需要手工检查僵尸进程 |



三、第三行信息为**CPU信息**

| 内容           | 说明                                                         |
| -------------- | ------------------------------------------------------------ |
| Cpu(s): 0.1%us | 用户模式占用的CPU百分比                                      |
| 0.1%sy         | 系统模式占用的CPU百分比                                      |
| 0.0%ni         | 改变过优先级的用户进程占用的CPU百分比                        |
| **99.7%id**    | **空闲CPU的百分比**                                          |
| 0.1%wa         | 等待输入/输出的进程的占用CPU百分比                           |
| 0.0%hi         | 硬中断请求服务占用的CPU百分比                                |
| 0.1%si         | 软中断请求服务占用的CPU百分比                                |
| 0.0%st         | st(Steal time)虚拟时间百分比。就是当有虚拟机时，虚拟CPU等待实际CPU的时间百分比。 |



四、第四行信息为**物理内存信息**

| 内容               | 说明                   |
| ------------------ | ---------------------- |
| Mem: 625344k total | 物理内存的总量，单位KB |
| 571504k used       | 已经使用的物理内存大小 |
| 53840k free        | 空闲的物理内存大小     |
| 65800k buffers     | 作为缓冲的内存大小     |



五、第五行信息为**交换分区(swap)信息**

| 内容                | 说明                                 |
| ------------------- | ------------------------------------ |
| Swap: 524280k total | 交换分区（虚拟内存）的总大小，单位KB |
| 0k used             | 已经使用的交换分区的大小             |
| 53840k free         | 空闲交换分区的大小                   |
| 65800k buffers      | 作为缓冲的交换分区的大小             |



5、查看进程树

语法：

> - `pstree [选项]`
> - 选项：
>   - -p：显示进程的PID
>   - -u：显示进程的所属用户





#### 12.1.2 进程管理

1、kill命令

语法：

> - `kill -l`
>
> ​        #查看可用的进程信号



| 信号代号 | 信号名称    | 说明                                                         |
| -------- | ----------- | ------------------------------------------------------------ |
| **1**    | **SIGHUP**  | **该信号让进程立即关闭，然后重新读取配置文件之后重启**       |
| 2        | SIGINT      | 程序终止信号，用于终止前台进程。相当于输出ctrl+c快捷键       |
| 8        | SIGFPE      | 在发生致命的算术运算错误时发出，不仅包括浮点运算错误，还包含溢出及除数为0等其他所有的算术的错误 |
| **9**    | **SIGKILL** | **用来立即结束程序的运行。本性不能被阻塞、处理和忽略。一般用于强制终止进程** |
| 14       | SIGALRM     | 时钟定时信号，计算的是实际的时间或时钟时间。alarm函数使用该信号 |
| **15**   | **SIGTERM** | **正常结束进程的信号，kill命令的默认信号。有时如果进程已经发生问题，这个信号是无法正常终止进程的，我们才会尝试SIGKILL信号，也就是信号9** |
| 18       | SIGCONT     | 该信号可以让暂停的进程恢复执行，本信号不能被阻断             |
| 19       | SIGSTOP     | 该信号可以暂停前台进程，相当于输入ctrl+z快捷键。本信号不能被阻断。 |



例：

~~~shell
[root@localhost ~]# kill -1 22354
#重启PID为22354的进程

[root@localhost ~]# kill -9 22368
#强制杀死PID为22368的进程
~~~



2、killall命令（按照进程名杀死进程）

语法：

> - `killall [选项] [信号] 进程名`
> - 选项：
>   - -i：	交互式，询问是否要杀死某个进程
>   - -I：    忽略进程名的大小写





### 12.2 工作管理

1、把进程放入后台

两种方式：

> - 执行命令时在执行语句后加“ &”
> - ctrl+z快捷键将前台当前正在运行的进程放入后天



2、查看后台的工作

语法：

> - `jobs [-l]`
> - 选项：
>   - -l：	显示工作的PID
>
> 注：“+”号代表最近一个放入后台的工作，也是工作恢复时，默认恢复的工作。“-”号代表倒数第二个放入后台的工作





3、将后台暂停的工作恢复到前台执行

> 语法：
>
> - fg %工作号
> - 参数：
>   - %工作号： %号可省略，但是注意工作号和PID的区别



4、把后台暂停的工作恢复到后台执行

> 语法：
>
> - `bg %工作号`
>
> 注：后台恢复执行的命令，是不能喝前台有交互的，否则不能恢复到后台执行







### 12.3 系统资源查看

1、vmstat命令监控系统资源

语法：

- `vmstat [刷新延时 刷新次数]`



2、dmesg开机时内核检测信息

语法：

- `dmesg`



3、free命令查看内存使用状态

> 语法：
>
> - `free [-b|-k|-m|-g]`
> - 选项：
>   - 各选项指代数据计量单位，默认为"-k"（KB）



缓存和缓冲区别

> - 简单来说缓存(cache)是用来加速数据从硬盘中“读取”的，而缓冲(buffer)是用来加速数据“写入”硬盘的。



4、查看CPU信息

> 语法：
>
> - `cat /proc/cpuinfo`



5、uptime命令

> 语法：
>
> - `uptime`
>
> ​       #显示系统的启动时间和平均负载，也就是top命令的第一行。w命令也可以看到这个数据。



6、查看系统与内核相关信息

> 语法：
>
> - `uname [选项]`
> - 选项：
>   - -a：	查看系统所有相关信息
>   - -r：     查看内核版本
>   - -s：     查看内核名称



判断当前系统位数

> 语法：
>
> - `file /bin/ls`



查看当前Linux系统的发行版本

> 语法：
>
> - `lsb_release -a`





7、列出进程打开或使用的文件信息

> 语法：
>
> - `lsof [选项]`
> - 选项：
>   - -c 字符串：	只列出以字符串开头的进程打开的文件
>   - -u 用户名：    只列出某个用户的进程打开的文件
>   - -p pid：          列出某个PID进程打开的文件





### 12.4 系统定时任务

1、crond服务管理与访问控制

**Linux系统默认crond为自启动**，下述命令了解



> 语法：
>
> - `service crond restart`
> - `chkconfig crond on`



2、用户的crontab设置

> 语法：
>
> - `crontab [选项]`
> - 选项：
>   - -e：	编辑crontab定时任务
>   - -l：     查询crontab任务
>   - -r：     删除当前用户所有的crontab任务



> `crontab -e`
>
> #进入crontab编辑界面。会打开vim编辑你的工作
>
> `* * * * * 执行的任务`

说明：

| 项目      | 含义                 | 范围                  |
| --------- | -------------------- | --------------------- |
| 第一个“*” | 一小时当中的第几分钟 | 0-59                  |
| 第二个“*” | 一天当中的第几小时   | 0-23                  |
| 第三个“*” | 一个月当中的第几天   | 1-31                  |
| 第四个“*” | 一年当中的第几月     | 1-12                  |
| 第五个“*” | 一周当中的星期几     | 0-7(0和7都代表星期日) |





| 特殊符号 | 含义                                                         |
| :------: | ------------------------------------------------------------ |
|    *     | 代表任何时间。比如第一个"*"代表一小时中每分钟都执行一次      |
|    ，    | 代表不连续的时间。比如“0 8,12,16 * * * 命令”，代表在每天8点0分，12点0分，16点0分都执行一次命令 |
|    -     | 代表连续的时间范围。比如“0 5 * * 1-6 命令”，代表在每周周一到周六的凌晨5点0分执行命令 |
|   */n    | 代表每隔多久执行一次。比如“*/10 * * * * 命令”，代表每隔10分钟执行一次命令 |







## 第十三章 日志管理

### 13.1 日志管理简介

1、日志服务

> - 在CentOS 6.x中日志服务已经由rsyslogd取代了原先的syslogd服务。rsyslogd日志服务更加先进，功能更多。但是学习起来基本和syslogd服务一致。
> - rsyslogd新特点：
>   - 基于TCP网络协议传输日志信息
>   - 更安全的网络传输方式
>   - 有日志消息的及时分析框架
>   - 后台数据库
>   - 配置文件中可以写简单的逻辑判断
>   - 与syslog配置文件相兼容



确定服务启动

~~~shell
#查看服务是否启动
ps aux | grep rsyslogd

#查看服务是否自启动
chkconfig --list |grep rsyslogd
~~~





2、常见日志作用

| 日志文件             | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| /var/log/cron        | 记录了系统定时任务相关的日志                                 |
| /var/log/cups/       | 记录打印信息的日志                                           |
| /var/log/dmesg       | 记录了系统在开机时内核自检的信息。也可以使用dmesg命令直接查看内核自检信息 |
| /var/log/btmp        | 记录错误登录的日志。这个文件是二进制文件，不能直接vi查看，而要使用`lastb`命令查看 |
| /var/log/lastlog     | 记录系统中所有用户最后一次的登录时间的日志。这个文件是二进制文件，不能直接vi查看，而要使用`lastlog`命令查看 |
| /var/log/mailog      | 记录邮件信息                                                 |
| **/var/log/message** | **记录系统重要信息的日志**。这个日志文件会记录Linux系统的绝大多数重要信息，如果系统出现问题时，首先要检查的就应该是这个日志文件 |
| /var/log/secure      | 记录验证和授权方面的信息，只要涉及账户和密码的程序都会记录。比如说系统的登录，ssh的登录，su切换用户，sudo授权，甚至添加用户和修改用户密码都会记录在这个日志文件中。 |
| /var/log/wtmp        | 永久记录所有用户的登录、注销信息，同时记录系统的启动、重启、关机事件。这个文件是二进制文件，不能直接vi查看，而要使用`last`命令查看 |
| /var/run/utmp        | 记录当前登录的用户信息，同时记录系统的启动、重启、关机事件。这个文件会随着用户的登录和注销而不断变化，只记录当前登录用户的信息。这个文件是二进制文件，不能直接vi查看，而要使用`w,who,users`等命令查看 |



​	除了系统默认的日志外，采用RPM方式安装的系统服务也会默认把日志记录在/var/log/目录中（源码包安装的服务日志是在源码包指定目录中）。不过这些日志不是由rsyslogd服务来记录和管理的，而是各个服务使用自己的日志管理文档来记录自身日志。



### 13.2 rsyslogd日志服务

1、日志文件格式

> - 基本日志格式包含以下四列：
>   - 事件产生的时间
>   - 发生事件的服务器的主机名
>   - 产生事件的服务名或程序名
>   - 时间的具体信息



2、/etc/rsyslog.conf配置文件

举例：

~~~shell
#格式：服务名称[连接符号]日志等级

#认证相关服务.所有日志等级    记录在/var/log/secure日志中
authpriv.*                /var/log/secure

~~~



连接符号：

> - 连接符号可以识别为：
>   - **“*”**		所有日志等级，比如：“authpriv.\*”代表authpriv认证信息服务产生的日志，所有日志等级都记录
>   - **“.”**         只要比后面的等级高（包含该等级）日志都记录
>   - **“.=”**       只记录所需等级的日志。
>   - **“.!”**        除了该等级日志，其他等级日志都记录



日志等级

| 等级名称 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| debug    | 一般的调试信息                                               |
| info     | 基本的通知信息                                               |
| notice   | 普通信息，但是有一定的重要性                                 |
| warning  | 警告信息，但是还不会影响到服务或系统的运行                   |
| err      | 错误信息，一般达到err等级的信息已经可影响到服务或系统的运行了 |
| crit     | 临界状况信息，比err等级还要严重                              |
| alert    | 警告状态信息，比crit还要严重。必须立即采取行动               |
| emerg    | 疼痛等级信息，系统已经无法使用了                             |





日志记录位置

> - 日志文件的绝对路径，如"/var/log/secure"
> - 系统设备文件，如"/dev/lp0"
> - 转发给远程主机，如"@192.168.0.210:514"
> - 用户名，如"root"
> - 忽略或丢弃日志，如"~"





### 13.3 日志轮替

1、日志文件的命名规则

> - 如果配置文件中拥有"dateext"参数，那么日志会用日期来作为日志文件的后缀，例如“secure-20130605”。这样的话日志文件名不会重置，所以也就不需要日志文件的改名，只需要保存指定的日志个数，删除多余的日志文件即可。
> - 如果配置文件中没有“dateext”参数，那么日志文件就需要进行改名了。当第一次进行日志轮替时，当前的“secure”日志会自动改名为“secure.1“，然后新建“secure”日志，用来保存新的日志。当第二次进行日志轮替时，“secure.1“会自动改名为“secure.2“，当前的“secure“日志会自动改名为“secure.1“，然后也会新建“secure“日志，用来保存新的日志，以此类推。



2、logrotate配置文件

| 参数                    | 参数说明                                                     |
| ----------------------- | ------------------------------------------------------------ |
| daily                   | 日志轮替周期是每天                                           |
| weekly                  | 日志轮替周期是每周                                           |
| monthly                 | 日志轮替周期是每月                                           |
| rotate 数字             | 保留日志文件的个数。0指没有备份                              |
| compress                | 日志轮替时，旧的日志进行压缩                                 |
| create mode owner group | 建立新日志，同时指定新日志的权限与所有者和所属组。如create 0600 root utmp |
| mail address            | 当日志轮替时，输出内容通过邮件发送到指定的邮件地址。         |
| missingok               | 如果日志不存在，则忽略该日志的警告信息                       |
| notifempty              | 如果日志为空文件，则不进行日志轮替                           |
| minsize 大小            | 日志轮替的最小值。也就是日志一定要达到这个最小值才会轮替，否则就算时间达到也不轮替 |
| size 大小               | 日志只有大于指定大小才进行日志轮替，而不是按照时间轮替。如size 100k |
| dateext                 | 使用日期作为日志轮替文件的后缀                               |







3、举例：把apache日志加入轮替

**rpm包安装的软件默认有日志轮替功能，不需单独配置，而源码包需要配置。**

~~~shell
vi /etc/logrotate.conf

/usr/local/apache2/logs/access_log{
	daily
	create
	rotate 30
}
~~~



4、logrotate命令

> 语法：
>
> - `logrotate [选项] 配置文件名`
> - 选项：
>   - 如果此命令没有选项，则会按照配置文件中的条件进行日志轮替
>   - -v：     显示日志轮替过程。加了-v选项，会显示日志的轮替的过程
>   - -f：      强制进行日志轮替。不管日志轮替的条件是否已经符合，强制配置文件中所有的日志进行轮替







## 第十四章 启动管理

### 14.1 CentOS 6.x启动管理

---

#### 14.1.1 系统运行级别

七个系统运行级别

| 等级 | 说明                                                        |
| :--: | :---------------------------------------------------------- |
|  0   | 表示关机                                                    |
|  1   | 单用户模式，可以想象为windows的安全模式，主要用于子系统修复 |
|  2   | 无网络连接的多用户命令行模式，不含NFS服务                   |
|  3   | 有网络连接的多用户命令行模式                                |
|  4   | 不可用，系统保留                                            |
|  5   | 带图形界面的多用户模式                                      |
|  6   | 重新启动                                                    |



2、系统默认运行级别

语法：

~~~shell
vim /etc/inittab

#系统开机后直接进入哪个运行级别
id:3:initdefault:
~~~



#### 14.1.2 系统启动过程

启动流程

![](D:\java\学习资料\Linux\img\Linux系统启动流程.png)



initramfs内存文件系统

> - CentOS 6.x中使用initramfs内存文件系统取代了CentOS 5.x中的initrd RAM Disk。他们的作用类似，可以通过启动引导程序加载到内存中，然后加载启动过程中所需要的内核模块，比如USB、SATA、SCSI硬盘的驱动和LVM、RAIDwe年系统的驱动。





调用/etc/init/rcS.conf配置文件主要功能：

> - 主要功能是两个：
>   - 先调用/etc/rc.d/rc.sysinit，然后由/etc/rc.d/rc.sysinit配置文件进行Linux系统初始化
>   - 然后再调用/etc/inittab，然后由/etc/inittab配置文件确定系统的默认运行级别。







### 14.2 启动引导程序grub

---

#### 14.2.1 Grub配置文件

1、grub配置文件

>  `vi /boot/grub/grub.conf`

> - default=0		默认启动第一个系统
> - timeout=5       等待时间，默认是5秒
> - splashimage=(hd0,0)/grub/splash.xpm.gz        这里是指定grub启动时的背景图像文件的保存位置的
> - hiddenmenu     隐藏菜单
> - title .......     title就是标题的意思
> - root (hd0,0)       是指启动程序的保存分区
> - kernel  ......        定义内核加载时的选项
> - initrd /initramfs-2.6.32-279.el6.i686.img         指定了initramfs内存文件系统镜像文件的所在位置





#### 14.2.2 Grub加密与字符界面分辨率调整



生成MD5加密字符串：

~~~shell
grub-md5-crypt
~~~







### 14.3 系统修复模式 









## 第十五章 备份与恢复

### 15.1 概述

1、Linux系统需要备份的数据

> - /root/目录
> - /home/目录
> - /var/spool/mail/目录
> - /etc/目录
> - 其他目录





2、备份策略

> - 完全备份：完全备份就是指把所有需要备份的数据全部备份，当然完全备份可以备份整块硬盘，整个分区或某个具体的目录
> - 



### 15.2 备份命令(dump和restore)

1、dump命令

语法：

> ```shell
> dump [选项] 备份之后的文件名 原文件或目录
> ```
>
> - 选项：
>   - -level：		就是0-9十个备份级别
>   - -f 文件名：  指定备份后的文件名
>   - -u：              备份成功后，把备份时间记录在/etc/dumpdates文件
>   - -v：              调用bzlib库压缩备份问价，其实就是把备份文件压缩为.bz2格式
>   - -W：             显示允许被dump分区的备份等级及备份时间





2、restore命令（恢复）

> - ```shell
>   restore [模式选项] [选项]
>   ```
>
> - 模式选项：restore命令常用模式有以下四种，这四种模式不能混用
>
>   - -C：	比较备份数据和实际数据的变化
>   - -i：     进入交互模式，手工选择需要恢复的文件
>   - -t：     查看模式，用于查看备份文件中拥有哪些数据
>   - -r：     还原模式，用于数据还原
>
> - 选项：
>
>   - -f：	指定备份文件的文件名







